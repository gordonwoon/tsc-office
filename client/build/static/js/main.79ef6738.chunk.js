(this["webpackJsonpsky-office-client"]=this["webpackJsonpsky-office-client"]||[]).push([[0],{140:function(e,t,a){},142:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=142},151:function(e,t,a){"use strict";a.r(t);a(110);var n=a(0),r=a.n(n),i=a(42),s=a.n(i),o=a(76),c=a(203),d=(a(140),a(22)),l=a.n(d),h=a(68),m=a.n(h),u=a(79),p=a(23),y=a(24),A=a(39),f=a(38),v=function(e){var t=15;e.create({key:"nancy_idle_right",frames:e.generateFrameNames("nancy",{start:0,end:5}),repeat:-1,frameRate:9}),e.create({key:"nancy_idle_up",frames:e.generateFrameNames("nancy",{start:6,end:11}),repeat:-1,frameRate:9}),e.create({key:"nancy_idle_left",frames:e.generateFrameNames("nancy",{start:12,end:17}),repeat:-1,frameRate:9}),e.create({key:"nancy_idle_down",frames:e.generateFrameNames("nancy",{start:18,end:23}),repeat:-1,frameRate:9}),e.create({key:"nancy_run_right",frames:e.generateFrameNames("nancy",{start:24,end:29}),repeat:-1,frameRate:t}),e.create({key:"nancy_run_up",frames:e.generateFrameNames("nancy",{start:30,end:35}),repeat:-1,frameRate:t}),e.create({key:"nancy_run_left",frames:e.generateFrameNames("nancy",{start:36,end:41}),repeat:-1,frameRate:t}),e.create({key:"nancy_run_down",frames:e.generateFrameNames("nancy",{start:42,end:47}),repeat:-1,frameRate:t}),e.create({key:"nancy_sit_down",frames:e.generateFrameNames("nancy",{start:48,end:48}),repeat:0,frameRate:t}),e.create({key:"nancy_sit_left",frames:e.generateFrameNames("nancy",{start:49,end:49}),repeat:0,frameRate:t}),e.create({key:"nancy_sit_right",frames:e.generateFrameNames("nancy",{start:50,end:50}),repeat:0,frameRate:t}),e.create({key:"nancy_sit_up",frames:e.generateFrameNames("nancy",{start:51,end:51}),repeat:0,frameRate:t}),e.create({key:"lucy_idle_right",frames:e.generateFrameNames("lucy",{start:0,end:5}),repeat:-1,frameRate:9}),e.create({key:"lucy_idle_up",frames:e.generateFrameNames("lucy",{start:6,end:11}),repeat:-1,frameRate:9}),e.create({key:"lucy_idle_left",frames:e.generateFrameNames("lucy",{start:12,end:17}),repeat:-1,frameRate:9}),e.create({key:"lucy_idle_down",frames:e.generateFrameNames("lucy",{start:18,end:23}),repeat:-1,frameRate:9}),e.create({key:"lucy_run_right",frames:e.generateFrameNames("lucy",{start:24,end:29}),repeat:-1,frameRate:t}),e.create({key:"lucy_run_up",frames:e.generateFrameNames("lucy",{start:30,end:35}),repeat:-1,frameRate:t}),e.create({key:"lucy_run_left",frames:e.generateFrameNames("lucy",{start:36,end:41}),repeat:-1,frameRate:t}),e.create({key:"lucy_run_down",frames:e.generateFrameNames("lucy",{start:42,end:47}),repeat:-1,frameRate:t}),e.create({key:"lucy_sit_down",frames:e.generateFrameNames("lucy",{start:48,end:48}),repeat:0,frameRate:t}),e.create({key:"lucy_sit_left",frames:e.generateFrameNames("lucy",{start:49,end:49}),repeat:0,frameRate:t}),e.create({key:"lucy_sit_right",frames:e.generateFrameNames("lucy",{start:50,end:50}),repeat:0,frameRate:t}),e.create({key:"lucy_sit_up",frames:e.generateFrameNames("lucy",{start:51,end:51}),repeat:0,frameRate:t}),e.create({key:"ash_idle_right",frames:e.generateFrameNames("ash",{start:0,end:5}),repeat:-1,frameRate:9}),e.create({key:"ash_idle_up",frames:e.generateFrameNames("ash",{start:6,end:11}),repeat:-1,frameRate:9}),e.create({key:"ash_idle_left",frames:e.generateFrameNames("ash",{start:12,end:17}),repeat:-1,frameRate:9}),e.create({key:"ash_idle_down",frames:e.generateFrameNames("ash",{start:18,end:23}),repeat:-1,frameRate:9}),e.create({key:"ash_run_right",frames:e.generateFrameNames("ash",{start:24,end:29}),repeat:-1,frameRate:t}),e.create({key:"ash_run_up",frames:e.generateFrameNames("ash",{start:30,end:35}),repeat:-1,frameRate:t}),e.create({key:"ash_run_left",frames:e.generateFrameNames("ash",{start:36,end:41}),repeat:-1,frameRate:t}),e.create({key:"ash_run_down",frames:e.generateFrameNames("ash",{start:42,end:47}),repeat:-1,frameRate:t}),e.create({key:"ash_sit_down",frames:e.generateFrameNames("ash",{start:48,end:48}),repeat:0,frameRate:t}),e.create({key:"ash_sit_left",frames:e.generateFrameNames("ash",{start:49,end:49}),repeat:0,frameRate:t}),e.create({key:"ash_sit_right",frames:e.generateFrameNames("ash",{start:50,end:50}),repeat:0,frameRate:t}),e.create({key:"ash_sit_up",frames:e.generateFrameNames("ash",{start:51,end:51}),repeat:0,frameRate:t}),e.create({key:"adam_idle_right",frames:e.generateFrameNames("adam",{start:0,end:5}),repeat:-1,frameRate:9}),e.create({key:"adam_idle_up",frames:e.generateFrameNames("adam",{start:6,end:11}),repeat:-1,frameRate:9}),e.create({key:"adam_idle_left",frames:e.generateFrameNames("adam",{start:12,end:17}),repeat:-1,frameRate:9}),e.create({key:"adam_idle_down",frames:e.generateFrameNames("adam",{start:18,end:23}),repeat:-1,frameRate:9}),e.create({key:"adam_run_right",frames:e.generateFrameNames("adam",{start:24,end:29}),repeat:-1,frameRate:t}),e.create({key:"adam_run_up",frames:e.generateFrameNames("adam",{start:30,end:35}),repeat:-1,frameRate:t}),e.create({key:"adam_run_left",frames:e.generateFrameNames("adam",{start:36,end:41}),repeat:-1,frameRate:t}),e.create({key:"adam_run_down",frames:e.generateFrameNames("adam",{start:42,end:47}),repeat:-1,frameRate:t}),e.create({key:"adam_sit_down",frames:e.generateFrameNames("adam",{start:48,end:48}),repeat:0,frameRate:t}),e.create({key:"adam_sit_left",frames:e.generateFrameNames("adam",{start:49,end:49}),repeat:0,frameRate:t}),e.create({key:"adam_sit_right",frames:e.generateFrameNames("adam",{start:50,end:50}),repeat:0,frameRate:t}),e.create({key:"adam_sit_up",frames:e.generateFrameNames("adam",{start:51,end:51}),repeat:0,frameRate:t})},g=a(27),b=a(46),O=a(81),j=a(82),x=a.n(j),k=function(){function e(t){Object(p.a)(this,e),this.userId=t,this.myPeer=void 0,this.myStream=void 0;var a=this.makeId(t);this.myPeer=new x.a(a),this.myPeer.on("error",(function(e){console.log("ShareScreenWebRTC err.type",e.type),console.error("ShareScreenWebRTC",e)})),this.myPeer.on("call",(function(e){e.answer(),e.on("stream",(function(t){$.dispatch(N({id:e.peer,call:e,stream:t}))})),e.on("closed",(function(){$.dispatch(P(e.peer))}))}))}return Object(y.a)(e,[{key:"onOpen",value:function(){this.myPeer.disconnected&&this.myPeer.reconnect()}},{key:"onClose",value:function(){this.stopScreenShare(!1),this.myPeer.disconnect()}},{key:"makeId",value:function(e){return"".concat(e.replace(/[^0-9a-z]/gi,"G"),"-ss")}},{key:"startScreenShare",value:function(){var e,t=this;null===(e=navigator.mediaDevices)||void 0===e||e.getDisplayMedia({video:!0,audio:!0}).then((function(e){var a=e.getVideoTracks()[0];a&&(a.onended=function(){t.stopScreenShare()}),t.myStream=e,$.dispatch(T(e));var n=Ee.scene.keys.game.computerMap.get($.getState().computer.computerId);if(n){var r,i=Object(O.a)(n.currentUsers);try{for(i.s();!(r=i.n()).done;){var s=r.value;t.onUserJoined(s)}}catch(o){i.e(o)}finally{i.f()}}}))}},{key:"stopScreenShare",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(null===(e=this.myStream)||void 0===e||e.getTracks().forEach((function(e){return e.stop()})),this.myStream=void 0,t){$.dispatch(T(null));var a=Ee.scene.keys.game;a.network.onStopScreenShare($.getState().computer.computerId)}}},{key:"onUserJoined",value:function(e){if(this.myStream&&e!==this.userId){var t=this.makeId(e);this.myPeer.call(t,this.myStream)}}},{key:"onUserLeft",value:function(e){if(e!==this.userId){var t=this.makeId(e);$.dispatch(P(t))}}}]),e}();function w(e){var t=e;return t.length>9&&t.endsWith("-ss")&&(t=t.substring(0,t.length-3)),t.replace(/[^0-9a-z]/gi,"G")}var C={computerDialogOpen:!1,computerId:null,myStream:null,peerStreams:new Map,shareScreenManager:null},E=Object(b.b)({name:"computer",initialState:C,reducers:{openComputerDialog:function(e,t){e.shareScreenManager||(e.shareScreenManager=new k(t.payload.myUserId)),e.shareScreenManager.onOpen(),e.computerDialogOpen=!0,e.computerId=t.payload.computerId},closeComputerDialog:function(e){var t;Ee.scene.keys.game.network.disconnectFromComputer(e.computerId);var a,n=Object(O.a)(e.peerStreams.values());try{for(n.s();!(a=n.n()).done;){a.value.call.close()}}catch(r){n.e(r)}finally{n.f()}null===(t=e.shareScreenManager)||void 0===t||t.onClose(),e.computerDialogOpen=!1,e.myStream=null,e.computerId=null,e.peerStreams.clear()},setMyStream:function(e,t){e.myStream=t.payload},addVideoStream:function(e,t){e.peerStreams.set(w(t.payload.id),{call:t.payload.call,stream:t.payload.stream})},removeVideoStream:function(e,t){e.peerStreams.delete(w(t.payload))}}}),S=E.actions,R=S.closeComputerDialog,_=S.openComputerDialog,T=S.setMyStream,N=S.addVideoStream,P=S.removeVideoStream,D=E.reducer,M=Object(b.b)({name:"whiteboard",initialState:{whiteboardDialogOpen:!1},reducers:{openWhiteboardDialog:function(e){e.whiteboardDialogOpen=!0},closeWhiteboardDialog:function(e){e.whiteboardDialogOpen=!1}}}),I=M.actions,B=I.openWhiteboardDialog,F=I.closeWhiteboardDialog,U=M.reducer,V=Object(b.b)({name:"user",initialState:{sessionId:"",connected:!1,videoConnected:!1,loggedIn:!1,playerNameMap:new Map},reducers:{setSessionId:function(e,t){e.sessionId=t.payload},setConnected:function(e,t){e.connected=t.payload},setVideoConnected:function(e,t){e.videoConnected=t.payload},setLoggedIn:function(e,t){e.loggedIn=t.payload},setPlayerNameMap:function(e,t){e.playerNameMap.set(w(t.payload.id),t.payload.name)},removePlayerNameMap:function(e,t){e.playerNameMap.delete(w(t.payload))}}}),G=V.actions,Y=G.setSessionId,L=G.setConnected,W=G.setVideoConnected,J=G.setLoggedIn,H=G.setPlayerNameMap,Z=G.removePlayerNameMap,Q=V.reducer,z=Object(b.b)({name:"chat",initialState:{messages:[]},reducers:{addMessage:function(e,t){e.messages.push(t.payload)}}}),K=z.actions.addMessage,X=z.reducer;Object(g.d)();var q,$=Object(b.a)({reducer:{user:Q,computer:D,whiteboard:U,chat:X},middleware:function(e){return e({serializableCheck:!1})}}),ee=function(e){Object(A.a)(a,e);var t=Object(f.a)(a);function a(e,n,r,i,s){var o;return Object(p.a)(this,a),(o=t.call(this,e,n,r,i,s)).dialogBox=void 0,o.statusBox=void 0,o.itemDirection=void 0,o.id=void 0,o.currentUsers=new Array,o.dialogBox=o.scene.add.container().setDepth(1e4),o.statusBox=o.scene.add.container().setDepth(1e4),o}return Object(y.a)(a,[{key:"onOverlapDialog",value:function(){switch(this.texture.key){case"chairs":this.setDialogBox("Press E to sit");break;case"computers":0===this.currentUsers.length?this.setDialogBox("Press R to use computer"):this.setDialogBox("Press R join");break;case"whiteboards":this.setDialogBox("Press R to use whiteboard",145)}}},{key:"setDialogBox",value:function(e,t){var a=this.scene.add.text(0,0,e).setFontFamily("Arial").setFontSize(12).setColor("#000000"),n=a.getBounds().width+4,r=a.getBounds().height+2,i=this.x-.5*n,s=this.y+.5*this.height;this.dialogBox.add(this.scene.add.graphics().fillStyle(16777215,1).fillRoundedRect(i,s,n,r,3).lineStyle(2,0,1).strokeRoundedRect(i,s,n,r,3)),this.dialogBox.add(a.setPosition(i+2,s))}},{key:"clearDialogBox",value:function(){this.dialogBox.removeAll(!0)}},{key:"setStatusBox",value:function(e){var t=this.scene.add.text(0,0,e).setFontFamily("Arial").setFontSize(12).setColor("#000000"),a=t.getBounds().width+4,n=t.getBounds().height+2,r=this.x-.5*a,i=this.y-.25*this.height;this.statusBox.add(this.scene.add.graphics().fillStyle(16777215,1).fillRoundedRect(r,i,a,n,3).lineStyle(2,0,1).strokeRoundedRect(r,i,a,n,3)),this.statusBox.add(t.setPosition(r+2,i))}},{key:"clearStatusBox",value:function(){this.statusBox.removeAll(!0)}},{key:"addCurrentUser",value:function(e){var t;null===(t=this.currentUsers)||void 0===t||t.push(e);var a,n=$.getState().computer;n.computerId===this.id&&(null===(a=n.shareScreenManager)||void 0===a||a.onUserJoined(e))}},{key:"removeCurrentUser",value:function(e){if(this.currentUsers){var t=this.currentUsers.indexOf(e);if(t>-1){this.currentUsers.splice(t,1);var a,n=$.getState().computer;if(n.computerId===this.id)null===(a=n.shareScreenManager)||void 0===a||a.onUserLeft(e)}}}},{key:"updateStatus",value:function(){var e=this.currentUsers.length;this.clearStatusBox(),1===e?this.setStatusBox("".concat(e," user")):e>1&&this.setStatusBox("".concat(e," users"))}}]),a}(l.a.Physics.Arcade.Sprite);!function(e){e[e.IDLE=0]="IDLE",e[e.SITTING=1]="SITTING"}(q||(q={}));var te,ae=new l.a.Events.EventEmitter;!function(e){e.PLAYER_JOINED="player-joined",e.PLAYER_UPDATED="player-updated",e.PLAYER_LEFT="player-left",e.PLAYER_DISCONNECTED="player-disconnected",e.MY_PLAYER_READY="my-player-ready",e.MY_PLAYER_NAME_CHANGE="my-player-name-change",e.MY_PLAYER_TEXTURE_CHANGE="my-player-texture-change",e.MY_PLAYER_VIDEO_CONNECTED="my-player-video-connected",e.ITEM_USER_ADDED="item-user-added",e.ITEM_USER_REMOVED="item-user-removed"}(te||(te={}));var ne={up:[0,3,-10],down:[0,3,1],left:[0,-8,10],right:[0,-8,10]},re=function(e){Object(A.a)(a,e);var t=Object(f.a)(a);function a(e,n,r,i,s,o){var c;Object(p.a)(this,a),(c=t.call(this,e,n,r,i,o)).playerId=void 0,c.playerTexture=void 0,c.playerBehavior=q.IDLE,c.readyToConnect=!1,c.videoConnected=!1,c.playerName=void 0,c.playerNameContainer=void 0,c.playerId=s,c.playerTexture=i,c.setDepth(c.y),c.playerNameContainer=c.scene.add.container(c.x,c.y-30).setDepth(5e3),c.anims.play("".concat(c.playerTexture,"_idle_down"),!0),c.playerName=c.scene.add.text(0,0,"").setFontFamily("Arial").setFontSize(12).setColor("#000000").setOrigin(.5),c.playerNameContainer.add(c.playerName),c.scene.physics.world.enable(c.playerNameContainer);var d=[.5,.2];return c.playerNameContainer.body.setSize(c.width*d[0],c.height*d[1]).setOffset(-8,c.height*(1-d[1])+6),c}return Object(y.a)(a,[{key:"setPlayerName",value:function(e){this.playerName.setText(e),ae.emit(te.MY_PLAYER_NAME_CHANGE,e)}},{key:"setPlayerTexture",value:function(e){this.playerTexture=e,this.anims.play("".concat(this.playerTexture,"_idle_down"),!0),ae.emit(te.MY_PLAYER_TEXTURE_CHANGE,this.x,this.y,this.anims.currentAnim.key)}}]),a}(l.a.Physics.Arcade.Sprite),ie=function(e){Object(A.a)(a,e);var t=Object(f.a)(a);function a(e,n,r,i,s,o){var c;return Object(p.a)(this,a),(c=t.call(this,e,n,r,i,s,o)).playNameContainerBody=void 0,c.itemOnSit=void 0,c.playNameContainerBody=c.playerNameContainer.body,c}return Object(y.a)(a,[{key:"update",value:function(e,t,a,n,r){var i,s,o,c,d=this;if(t){var h=e.selectedItem;if(l.a.Input.Keyboard.JustDown(n))switch(null===h||void 0===h?void 0:h.texture.key){case"computers":h.id&&($.dispatch(_({computerId:h.id,myUserId:this.playerId})),r.connectToComputer(h.id));break;case"whiteboards":$.dispatch(B())}switch(this.playerBehavior){case q.IDLE:if(l.a.Input.Keyboard.JustDown(a)&&"chairs"===(null===h||void 0===h?void 0:h.texture.key))return this.scene.time.addEvent({delay:10,callback:function(){d.setVelocity(0,0),h.itemDirection&&(d.setPosition(h.x+ne[h.itemDirection][0],h.y+ne[h.itemDirection][1]).setDepth(h.depth+ne[h.itemDirection][2]),d.playNameContainerBody.setVelocity(0,0),d.playerNameContainer.setPosition(h.x+ne[h.itemDirection][0],h.y+ne[h.itemDirection][1]-30)),d.play("".concat(d.playerTexture,"_sit_").concat(h.itemDirection),!0),e.selectedItem=void 0,e.setPosition(d.x,d.y-d.height),r.updatePlayer(d.x,d.y,d.anims.currentAnim.key)},loop:!1}),h.clearDialogBox(),h.setDialogBox("Press E to leave"),this.itemOnSit=h,void(this.playerBehavior=q.SITTING);var m=200,u=0,p=0;if((null===(i=t.left)||void 0===i?void 0:i.isDown)&&(u-=m),(null===(s=t.right)||void 0===s?void 0:s.isDown)&&(u+=m),(null===(o=t.up)||void 0===o?void 0:o.isDown)&&(p-=m,this.setDepth(this.y)),(null===(c=t.down)||void 0===c?void 0:c.isDown)&&(p+=m,this.setDepth(this.y)),this.setVelocity(u,p),this.body.velocity.setLength(m),this.playNameContainerBody.setVelocity(u,p),this.playNameContainerBody.velocity.setLength(m),0===u&&0===p||r.updatePlayer(this.x,this.y,this.anims.currentAnim.key),u>0)this.play("".concat(this.playerTexture,"_run_right"),!0);else if(u<0)this.play("".concat(this.playerTexture,"_run_left"),!0);else if(p>0)this.play("".concat(this.playerTexture,"_run_down"),!0);else if(p<0)this.play("".concat(this.playerTexture,"_run_up"),!0);else{var y=this.anims.currentAnim.key.split("_");y[1]="idle";var A=y.join("_");this.anims.currentAnim.key!==A&&(this.play(y.join("_"),!0),r.updatePlayer(this.x,this.y,this.anims.currentAnim.key))}break;case q.SITTING:if(l.a.Input.Keyboard.JustDown(a)){var f,v=this.anims.currentAnim.key.split("_");v[1]="idle",this.play(v.join("_"),!0),this.playerBehavior=q.IDLE,null===(f=this.itemOnSit)||void 0===f||f.clearDialogBox(),e.setPosition(this.x,this.y),e.update(this,t),r.updatePlayer(this.x,this.y,this.anims.currentAnim.key)}}}}}]),a}(re);l.a.GameObjects.GameObjectFactory.register("myPlayer",(function(e,t,a,n,r){var i=new ie(this.scene,e,t,a,n,r);this.displayList.add(i),this.updateList.add(i),this.scene.physics.world.enableBody(i,l.a.Physics.Arcade.DYNAMIC_BODY);var s=[.5,.2];return i.body.setSize(i.width*s[0],i.height*s[1]).setOffset(i.width*(1-s[0])*.5,i.height*(1-s[1])),i}));var se=a(100),oe=a(55),ce=function(e){Object(A.a)(a,e);var t=Object(f.a)(a);function a(e,n,r,i,s,o,c){var d;return Object(p.a)(this,a),(d=t.call(this,e,n,r,i,s,c)).targetPosition=void 0,d.lastUpdateTimestamp=void 0,d.connectionBufferTime=0,d.connected=!1,d.playNameContainerBody=void 0,d.myPlayer=void 0,d.targetPosition=[n,r],d.playerName.setText(o),d.playNameContainerBody=d.playerNameContainer.body,d}return Object(y.a)(a,[{key:"makeCall",value:function(e,t){this.myPlayer=e;var a=e.playerId;!this.connected&&this.connectionBufferTime>=750&&e.readyToConnect&&this.readyToConnect&&(e.videoConnected&&!this.videoConnected||e.videoConnected&&this.videoConnected&&a>this.playerId)&&(t.connectToNewUser(this.playerId),this.connected=!0,this.connectionBufferTime=0)}},{key:"updateOtherPlayer",value:function(e,t){switch(e){case"name":"string"===typeof t&&this.playerName.setText(t);break;case"x":"number"===typeof t&&(this.targetPosition[0]=t);break;case"y":"number"===typeof t&&(this.targetPosition[1]=t);break;case"anim":"string"===typeof t&&this.anims.play(t,!0);break;case"readyToConnect":"boolean"===typeof t&&(this.readyToConnect=t);break;case"videoConnected":"boolean"===typeof t&&(this.videoConnected=t)}}},{key:"destroy",value:function(e){this.playerNameContainer.destroy(),Object(se.a)(Object(oe.a)(a.prototype),"destroy",this).call(this,e)}},{key:"preUpdate",value:function(e,t){if(Object(se.a)(Object(oe.a)(a.prototype),"preUpdate",this).call(this,e,t),this.lastUpdateTimestamp&&e-this.lastUpdateTimestamp>750)return this.lastUpdateTimestamp=e,this.x=this.targetPosition[0],this.y=this.targetPosition[1],this.playerNameContainer.x=this.targetPosition[0],void(this.playerNameContainer.y=this.targetPosition[1]-30);this.lastUpdateTimestamp=e,this.setDepth(this.y);var n=this.anims.currentAnim.key.split("_");if("sit"===n[1]){var r=n[2];ne[r]&&this.setDepth(this.depth+ne[r][2])}var i=200,s=.2*t,o=this.targetPosition[0]-this.x,c=this.targetPosition[1]-this.y;Math.abs(o)<s&&(this.x=this.targetPosition[0],this.playerNameContainer.x=this.targetPosition[0],o=0),Math.abs(c)<s&&(this.y=this.targetPosition[1],this.playerNameContainer.y=this.targetPosition[1]-30,c=0);var d=0,l=0;if(o>0?d+=i:o<0&&(d-=i),c>0?l+=i:c<0&&(l-=i),this.setVelocity(d,l),this.body.velocity.setLength(i),this.playNameContainerBody.setVelocity(d,l),this.playNameContainerBody.velocity.setLength(i),this.connectionBufferTime+=t,this.connected&&!this.body.embedded&&this.body.touching.none&&this.connectionBufferTime>=750){if(this.x<610&&this.y>515&&this.myPlayer.x<610&&this.myPlayer.y>515)return;ae.emit(te.PLAYER_DISCONNECTED,this.playerId),this.connectionBufferTime=0,this.connected=!1}}}]),a}(re);l.a.GameObjects.GameObjectFactory.register("otherPlayer",(function(e,t,a,n,r,i){var s=new ce(this.scene,e,t,a,n,r,i);this.displayList.add(s),this.updateList.add(s),this.scene.physics.world.enableBody(s,l.a.Physics.Arcade.DYNAMIC_BODY);var o=[6,4];return s.body.setSize(s.width*o[0],s.height*o[1]).setOffset(s.width*(1-o[0])*.5,s.height*(1-o[1])*.5+17),s}));var de,le=a(80),he=function(e){Object(A.a)(a,e);var t=Object(f.a)(a);function a(e,n,r,i,s){var o;return Object(p.a)(this,a),(o=t.call(this,e,n,r,i,s)).selectedItem=void 0,e.physics.add.existing(Object(le.a)(o)),o}return Object(y.a)(a,[{key:"update",value:function(e,t){var a,n,r,i;if(t&&e.playerBehavior!==q.SITTING){var s=e.x,o=e.y;(null===(a=t.left)||void 0===a?void 0:a.isDown)?this.setPosition(s-32,o):(null===(n=t.right)||void 0===n?void 0:n.isDown)?this.setPosition(s+32,o):(null===(r=t.up)||void 0===r?void 0:r.isDown)?this.setPosition(s,o-32):(null===(i=t.down)||void 0===i?void 0:i.isDown)&&this.setPosition(s,o+32),this.selectedItem&&(this.scene.physics.overlap(this,this.selectedItem)||(this.selectedItem.clearDialogBox(),this.selectedItem=void 0))}}}]),a}(l.a.GameObjects.Zone),me=a(113);!function(e){e[e.UPDATE_PLAYER=0]="UPDATE_PLAYER",e[e.UPDATE_PLAYER_NAME=1]="UPDATE_PLAYER_NAME",e[e.READY_TO_CONNECT=2]="READY_TO_CONNECT",e[e.DISCONNECT_STREAM=3]="DISCONNECT_STREAM",e[e.CONNECT_TO_COMPUTER=4]="CONNECT_TO_COMPUTER",e[e.DISCONNECT_FROM_COMPUTER=5]="DISCONNECT_FROM_COMPUTER",e[e.STOP_SCREEN_SHARE=6]="STOP_SCREEN_SHARE",e[e.VIDEO_CONNECTED=7]="VIDEO_CONNECTED",e[e.ADD_CHAT_MESSAGE=8]="ADD_CHAT_MESSAGE"}(de||(de={}));var ue=function(){function e(t,a){var n=this;Object(p.a)(this,e),this.myPeer=void 0,this.peers=new Map,this.onCalledVideos=new Map,this.videoGrid=document.querySelector(".video-grid"),this.buttonGrid=document.querySelector(".button-grid"),this.myVideo=document.createElement("video"),this.myStream=void 0,this.network=void 0;var r=this.replaceInvalidId(t);this.myPeer=new x.a(r),this.network=a,console.log("userId:",t),console.log("sanitizedId:",r),this.myPeer.on("error",(function(e){console.log(e.type),console.log(e)})),this.myVideo.muted=!0,this.initialize();navigator.permissions.query({name:"microphone"}).then((function(e){"granted"===e.state&&n.getUserMedia()}))}return Object(y.a)(e,[{key:"replaceInvalidId",value:function(e){return e.replace(/[^0-9a-z]/gi,"G")}},{key:"initialize",value:function(){var e=this;this.myPeer.on("call",(function(t){t.answer(e.myStream);var a=document.createElement("video");t.on("stream",(function(t){e.addVideoStream(a,t)})),t.on("closed",(function(){a.remove(),e.onCalledVideos.delete(t.peer)})),t.on("error",(function(e){console.log(e)})),e.onCalledVideos.set(t.peer,a)}))}},{key:"getUserMedia",value:function(){var e,t=this;null===(e=navigator.mediaDevices)||void 0===e||e.getUserMedia({video:!0,audio:!0}).then((function(e){t.myStream=e,t.addVideoStream(t.myVideo,t.myStream),t.setUpButtons(),$.dispatch(W(!0)),t.network.videoConnected()})).catch((function(e){$.dispatch(W(!1)),window.alert("No webcam or microphone found, or permission is blocked")}))}},{key:"connectToNewUser",value:function(e){var t=this;if(console.log("calling"),this.myStream){var a=this.replaceInvalidId(e);if(!this.onCalledVideos.has(a)){var n=this.myPeer.call(a,this.myStream),r=document.createElement("video");n.on("stream",(function(e){t.addVideoStream(r,e)})),n.on("close",(function(){r.remove()})),this.peers.set(a,n)}}}},{key:"addVideoStream",value:function(e,t){e.srcObject=t,e.addEventListener("loadedmetadata",(function(){e.play()})),this.videoGrid&&this.videoGrid.append(e)}},{key:"deleteVideoStream",value:function(e){var t=this.replaceInvalidId(e);if(this.peers.has(t)){var a=this.peers.get(t);null===a||void 0===a||a.close(),this.peers.delete(t)}}},{key:"deleteOnCalledVideoStream",value:function(e){var t=this.replaceInvalidId(e);if(this.onCalledVideos.has(t)){var a=this.onCalledVideos.get(t);null===a||void 0===a||a.remove(),this.onCalledVideos.delete(t)}}},{key:"setUpButtons",value:function(){var e,t,a=this,n=document.createElement("button");n.innerText="Mute",n.addEventListener("click",(function(){if(a.myStream){var e=a.myStream.getAudioTracks()[0];e.enabled?(e.enabled=!1,n.innerText="Unmute"):(e.enabled=!0,n.innerText="Mute")}}));var r=document.createElement("button");r.innerText="Video off",r.addEventListener("click",(function(){if(a.myStream){var e=a.myStream.getVideoTracks()[0];e.enabled?(e.enabled=!1,r.innerText="Video on"):(e.enabled=!0,r.innerText="Video off")}})),null===(e=this.buttonGrid)||void 0===e||e.append(n),null===(t=this.buttonGrid)||void 0===t||t.append(r)}}]),e}(),pe=function(){function e(){Object(p.a)(this,e),this.client=void 0,this.room=void 0,this.webRTC=void 0,this.mySessionId=void 0;window.location.protocol.replace("http","ws");this.client=new me.Client("wss://tsc-office.herokuapp.com"),ae.on(te.MY_PLAYER_NAME_CHANGE,this.updatePlayerName,this),ae.on(te.MY_PLAYER_TEXTURE_CHANGE,this.updatePlayer,this),ae.on(te.PLAYER_DISCONNECTED,this.playerStreamDisconnect,this)}return Object(y.a)(e,[{key:"join",value:function(){var e=Object(u.a)(m.a.mark((function e(){var t=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.joinOrCreate("skyoffice");case 2:this.room=e.sent,this.mySessionId=this.room.sessionId,$.dispatch(Y(this.room.sessionId)),this.webRTC=new ue(this.mySessionId,this),this.room.state.players.onAdd=function(e,a){a!==t.mySessionId&&(ae.emit(te.PLAYER_JOINED,e,a),e.onChange=function(e){e.forEach((function(e){var t=e.field,n=e.value;ae.emit(te.PLAYER_UPDATED,t,n,a),"name"===t&&$.dispatch(H({id:a,name:n}))}))})},this.room.state.players.onRemove=function(e,a){var n,r;ae.emit(te.PLAYER_LEFT,a),null===(n=t.webRTC)||void 0===n||n.deleteVideoStream(a),null===(r=t.webRTC)||void 0===r||r.deleteOnCalledVideoStream(a),$.dispatch(Z(a))},this.room.state.computers.onAdd=function(e,t){e.connectedUser.onAdd=function(e,a){ae.emit(te.ITEM_USER_ADDED,e,t)},e.connectedUser.onRemove=function(e,a){ae.emit(te.ITEM_USER_REMOVED,e,t)}},this.room.state.chatMessages.onAdd=function(e,t){$.dispatch(K(e))},this.room.onMessage(de.DISCONNECT_STREAM,(function(e){var a;null===(a=t.webRTC)||void 0===a||a.deleteOnCalledVideoStream(e)})),this.room.onMessage(de.STOP_SCREEN_SHARE,(function(e){var t;null===(t=$.getState().computer.shareScreenManager)||void 0===t||t.onUserLeft(e)}));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onItemUserAdded",value:function(e,t){ae.on(te.ITEM_USER_ADDED,e,t)}},{key:"onItemUserRemoved",value:function(e,t){ae.on(te.ITEM_USER_REMOVED,e,t)}},{key:"onPlayerJoined",value:function(e,t){ae.on(te.PLAYER_JOINED,e,t)}},{key:"onPlayerLeft",value:function(e,t){ae.on(te.PLAYER_LEFT,e,t)}},{key:"onMyPlayerReady",value:function(e,t){ae.on(te.MY_PLAYER_READY,e,t)}},{key:"onMyPlayerVideoConnected",value:function(e,t){ae.on(te.MY_PLAYER_VIDEO_CONNECTED,e,t)}},{key:"onPlayerUpdated",value:function(e,t){ae.on(te.PLAYER_UPDATED,e,t)}},{key:"updatePlayer",value:function(e,t,a){var n;null===(n=this.room)||void 0===n||n.send(de.UPDATE_PLAYER,{x:e,y:t,anim:a})}},{key:"updatePlayerName",value:function(e){var t;null===(t=this.room)||void 0===t||t.send(de.UPDATE_PLAYER_NAME,{name:e})}},{key:"readyToConnect",value:function(){var e;null===(e=this.room)||void 0===e||e.send(de.READY_TO_CONNECT),ae.emit(te.MY_PLAYER_READY)}},{key:"videoConnected",value:function(){var e;null===(e=this.room)||void 0===e||e.send(de.VIDEO_CONNECTED),ae.emit(te.MY_PLAYER_VIDEO_CONNECTED)}},{key:"playerStreamDisconnect",value:function(e){var t,a;null===(t=this.room)||void 0===t||t.send(de.DISCONNECT_STREAM,{clientId:e}),null===(a=this.webRTC)||void 0===a||a.deleteVideoStream(e)}},{key:"connectToComputer",value:function(e){var t;null===(t=this.room)||void 0===t||t.send(de.CONNECT_TO_COMPUTER,{computerId:e})}},{key:"disconnectFromComputer",value:function(e){var t;null===(t=this.room)||void 0===t||t.send(de.DISCONNECT_FROM_COMPUTER,{computerId:e})}},{key:"onStopScreenShare",value:function(e){var t;null===(t=this.room)||void 0===t||t.send(de.STOP_SCREEN_SHARE,{computerId:e})}},{key:"onChatMessage",value:function(e){var t;null===(t=this.room)||void 0===t||t.send(de.ADD_CHAT_MESSAGE,{content:e})}},{key:"getRoom",value:function(){return this.room}}]),e}(),ye=function(e){Object(A.a)(a,e);var t=Object(f.a)(a);function a(){var e;return Object(p.a)(this,a),(e=t.call(this,"game")).network=void 0,e.cursors=void 0,e.keyE=void 0,e.keyR=void 0,e.map=void 0,e.myPlayer=void 0,e.items=void 0,e.playerSelector=void 0,e.otherPlayers=void 0,e.otherPlayerMap=new Map,e.computerMap=new Map,e}return Object(y.a)(a,[{key:"registerKeys",value:function(){this.cursors=this.input.keyboard.createCursorKeys(),this.keyE=this.input.keyboard.addKey("E"),this.keyR=this.input.keyboard.addKey("R")}},{key:"init",value:function(){this.network=new pe}},{key:"create",value:function(){var e=Object(u.a)(m.a.mark((function e(){var t,a,n,r,i=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.network){e.next=2;break}throw new Error("server instance missing");case 2:return e.next=4,this.network.join();case 4:$.dispatch(L(!0)),this.scene.stop("preloader"),v(this.anims),this.map=this.make.tilemap({key:"tilemap"}),t=this.map.addTilesetImage("FloorAndGround","tiles_wall"),(a=this.map.createLayer("Ground",t)).setCollisionByProperty({collides:!0}),this.myPlayer=this.add.myPlayer(900,930,"adam",this.network.mySessionId),this.playerSelector=new he(this,0,0,16,16),this.items=this.physics.add.staticGroup({classType:ee}),this.map.getObjectLayer("Chair").objects.forEach((function(e){i.addObjectFromTiled(i.items,e,"chairs","chair").itemDirection=e.properties[0].value})),n=this.map.getObjectLayer("Computer"),r=0,n.objects.forEach((function(e){var t=i.addObjectFromTiled(i.items,e,"computers","computer");t.setDepth(t.y+.6*t.height);var a=String(r);t.id=a,t.scale=.7,i.computerMap.set(a,t),++r})),this.map.getObjectLayer("Whiteboard").objects.forEach((function(e){i.addObjectFromTiled(i.items,e,"whiteboards","whiteboard")})),this.addGroupFromTiled("Wall","tiles_wall","FloorAndGround",!1),this.addGroupFromTiled("Objects","office","Modern_Office_Black_Shadow",!1),this.addGroupFromTiled("ObjectsOnCollide","office","Modern_Office_Black_Shadow",!0),this.addGroupFromTiled("GenericObjectsOnCollide","generic","Generic",!0),this.addGroupFromTiled("GenericObjects","generic","Generic",!1),this.otherPlayers=this.physics.add.group({classType:ce}),this.cameras.main.zoom=1.5,this.cameras.main.startFollow(this.myPlayer,!0),this.physics.add.collider([this.myPlayer,this.myPlayer.playerNameContainer],a),this.physics.add.overlap(this.playerSelector,this.items,this.handleItemSelectorOverlap,void 0,this),this.physics.add.overlap(this.myPlayer,this.otherPlayers,this.handlePlayersOverlap,void 0,this),this.network.onPlayerJoined(this.handlePlayerJoined,this),this.network.onPlayerLeft(this.handlePlayerLeft,this),this.network.onMyPlayerReady(this.handleMyPlayerReady,this),this.network.onMyPlayerVideoConnected(this.handleMyVideoConnected,this),this.network.onPlayerUpdated(this.handlePlayerUpdated,this),this.network.onItemUserAdded(this.handleItemUserAdded,this),this.network.onItemUserRemoved(this.handleItemUserRemoved,this);case 39:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleItemSelectorOverlap",value:function(e,t){var a=e.selectedItem;if(a){if(a===t||a.depth>=t.depth)return;this.myPlayer.playerBehavior!==q.SITTING&&a.clearDialogBox()}e.selectedItem=t,t.onOverlapDialog()}},{key:"addObjectFromTiled",value:function(e,t,a,n){var r=t.x+.5*t.width,i=t.y-.5*t.height;return e.get(r,i,a,t.gid-this.map.getTileset(n).firstgid).setDepth(i)}},{key:"addGroupFromTiled",value:function(e,t,a,n){var r=this,i=this.physics.add.staticGroup();this.map.getObjectLayer(e).objects.forEach((function(e){var n=e.x+.5*e.width,s=e.y-.5*e.height;i.get(n,s,t,e.gid-r.map.getTileset(a).firstgid).setDepth(s)})),this.myPlayer&&n&&this.physics.add.collider([this.myPlayer,this.myPlayer.playerNameContainer],i)}},{key:"handlePlayerJoined",value:function(e,t){var a=this.add.otherPlayer(e.x,e.y,"adam",t,e.name);this.otherPlayers.add(a),this.otherPlayerMap.set(t,a)}},{key:"handlePlayerLeft",value:function(e){if(this.otherPlayerMap.has(e)){var t=this.otherPlayerMap.get(e);if(!t)return;this.otherPlayers.remove(t,!0,!0),this.otherPlayerMap.delete(e)}}},{key:"handleMyPlayerReady",value:function(){this.myPlayer.readyToConnect=!0}},{key:"handleMyVideoConnected",value:function(){this.myPlayer.videoConnected=!0}},{key:"handlePlayerUpdated",value:function(e,t,a){var n=this.otherPlayerMap.get(a);null===n||void 0===n||n.updateOtherPlayer(e,t)}},{key:"handlePlayersOverlap",value:function(e,t){var a;t.makeCall(e,null===(a=this.network)||void 0===a?void 0:a.webRTC)}},{key:"handleItemUserAdded",value:function(e,t){var a=this.computerMap.get(t);null===a||void 0===a||a.addCurrentUser(e),null===a||void 0===a||a.updateStatus()}},{key:"handleItemUserRemoved",value:function(e,t){var a=this.computerMap.get(t);null===a||void 0===a||a.removeCurrentUser(e),null===a||void 0===a||a.updateStatus()}},{key:"update",value:function(e,t){this.myPlayer&&this.network&&(this.playerSelector.update(this.myPlayer,this.cursors),this.myPlayer.update(this.playerSelector,this.cursors,this.keyE,this.keyR,this.network))}}]),a}(l.a.Scene),Ae=function(e){Object(A.a)(a,e);var t=Object(f.a)(a);function a(){var e;return Object(p.a)(this,a),(e=t.call(this,"preloader")).counter=0,e}return Object(y.a)(a,[{key:"preload",value:function(){this.load.tilemapTiledJSON("tilemap","assets/map/map.json"),this.load.spritesheet("tiles_wall","assets/map/FloorAndGround.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("chairs","assets/items/chair.png",{frameWidth:32,frameHeight:64}),this.load.spritesheet("computers","assets/items/computer.png",{frameWidth:96,frameHeight:64}),this.load.spritesheet("whiteboards","assets/items/whiteboard.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("office","assets/items/Modern_Office_Black_Shadow.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("generic","assets/items/Generic.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("adam","assets/character/adam.png",{frameWidth:32,frameHeight:48}),this.load.spritesheet("ash","assets/character/ash.png",{frameWidth:32,frameHeight:48}),this.load.spritesheet("lucy","assets/character/lucy.png",{frameWidth:32,frameHeight:48}),this.load.spritesheet("nancy","assets/character/nancy.png",{frameWidth:32,frameHeight:48})}},{key:"create",value:function(){var e=this,t=this.cameras.main.worldView.x+this.cameras.main.width/2,a=this.cameras.main.worldView.y+this.cameras.main.height,n=this.add.text(t,a-100,"Loading...").setOrigin(.5).setFontSize(30).setColor("#000000");this.time.addEvent({delay:750,callback:function(){switch(e.counter%3){case 0:n.setText("loading.");break;case 1:n.setText("loading..");break;case 2:n.setText("loading...")}e.counter+=1},loop:!0}),this.scene.run("game")}}]),a}(l.a.Scene),fe={type:l.a.AUTO,parent:"phaser-container",backgroundColor:"#CFF5FC",pixelArt:!0,scale:{mode:l.a.Scale.ScaleModes.RESIZE,width:window.innerWidth,height:window.innerHeight},physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},autoFocus:!0,scene:[Ae,ye]},ve=new l.a.Game(fe);window.game=ve;var ge,be,Oe,je,xe,ke,we,Ce,Ee=ve,Se=a(119),Re=Object(Se.a)({palette:{mode:"dark",primary:{main:"#426dea"},secondary:{main:"#42eacb"}}}),_e=function(){return Object(o.b)()},Te=o.c,Ne=a(15),Pe=a(17),De=a(19),Me=a(196),Ie=a(205),Be=a(199),Fe=a(201),Ue=a(197),Ve=a(187),Ge=a(195),Ye=a(186),Le=(a(144),a(145),a(1));Ge.a.use([Ye.a]);var We=De.a.div(ge||(ge=Object(Pe.a)(["\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background: #222639;\n  border-radius: 16px;\n  padding: 36px 60px;\n"]))),Je=De.a.h1(be||(be=Object(Pe.a)(["\n  font-size: 24px;\n  color: #eee;\n  text-align: center;\n"]))),He=De.a.h3(Oe||(Oe=Object(Pe.a)(["\n  width: 160px;\n  font-size: 16px;\n  color: #eee;\n  text-align: center;\n"]))),Ze=De.a.div(je||(je=Object(Pe.a)(["\n  display: flex;\n  margin: 36px 0;\n"]))),Qe=De.a.div(xe||(xe=Object(Pe.a)(["\n  margin-right: 48px;\n\n  --swiper-navigation-size: 24px;\n\n  .swiper-container {\n    width: 160px;\n    height: 220px;\n    border-radius: 8px;\n    overflow: hidden;\n  }\n\n  .swiper-slide {\n    width: 160px;\n    height: 220px;\n    background: #dbdbe0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n\n  .swiper-slide img {\n    display: block;\n    width: 95px;\n    height: 136px;\n    object-fit: contain;\n  }\n"]))),ze=De.a.div(ke||(ke=Object(Pe.a)(["\n  width: 300px;\n"]))),Ke=De.a.div(we||(we=Object(Pe.a)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"]))),Xe=De.a.div(Ce||(Ce=Object(Pe.a)(["\n  margin-top: 30px;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n"]))),qe=[{name:"adam",img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAABICAMAAACHrYYZAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAclBMVEUAAABWWXJrb2lIS1RAQFc6OlBcYWdcX1dGRl5gY1xISVNISVhFRlBCQll0Z3JRSWZUTGpuXGR0YmuDbG88PFJHR19RRmRWWXJGRl46OlCVnVhoclNfaUpdYEO7o4b/y7D2rp/2l4SAXo6fdKj/uJP///9thjlLAAAAF3RSTlMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAL2TUGAAAAABYktHRCXDAckPAAAAB3RJTUUH5QoFBSgkkKZAkgAAAAFvck5UAc+id5oAAAFaSURBVEjHzZbHcoNAEERFzhljYZMM/P83ukUDhUxpb4zcB7Q704/SpmFvt/8nTdN0Xf9cdH9WXdeGYZimaVmWJGDbNqxfJ30vIuY4juu6YgDcSLwCmqZBG5jneStzPYAOc2c3AaZgw/wKAwoBw+T6vv8YxvUA95zCymfbtuswrgeCIKgXIdRsOmPIwhOGoQBAK93IdV1HU7dpB8gIA0j3fU93vwntdwG9UsIAdtUwDGoABhY1AQBbHK09gdDRd+zCFkWRAIBCEMfxPgws6hFglwOA7VE1rgfwwUuShMDPouGgPQJDmqZiAOZuHMe7UjTIAFmWAZimaVQKBgB5ngsA+JnnmYxCtOEpBmA5eVbP/54nEwYxoCgKhljRzmvM+sXXwSwAYD+hcJRlidCrrzVSMMC2numLAYqngun9iszrIIGny7EgwKVF42PRMfIWoKoqriga1qI/ESngF89yOEmzGHKGAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIxLTEwLTA1VDA1OjM5OjUxKzAwOjAwksUfagAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMS0xMC0wNVQwNTozOTo1MSswMDowMOOYp9YAAAAASUVORK5CYII="},{name:"ash",img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAABICAMAAACHrYYZAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAdVBMVEUAAABWWXJ3amtgVVlGRl5dVFlOT2hdVl9XTVtAQFc+PlQ6OlBSR1JuXGSDbG88PFJHR19EPU5WWXJGRl66jV6Vc1CNcFGKZVI6OlD2rp//y7BaRErhm5uiOUtvSU2Li6v/uJOuSlKdo7f2l4R4fZOAkaX////gL/b+AAAAEnRSTlMAAAAAAAAAAAAAAAAAAAAAAACVcz0/AAAAAWJLR0QmWgiYtQAAAAd0SU1FB+UKBgI7LZ9vAM8AAAABb3JOVAHPoneaAAABUElEQVRIx+2W21aDMBBF20KBQilWLVdLQfT/f9FtpsZYZOkLgw+eB5g5nL1WSAiwWv3r11qv15vN5t7oYSTP83zf1wRs+nGkkxHMdrv9ZOYHgiD4Nm2ZPM9h1ABOYRjS/whEUfTOzA/sdjsamb6paQUoioIYYQUgjuOyLE/Tyj9EjLACkCQJFf04cSNihNUAZs29VlVVXdd/BKiMaiNZYPEpFgHctAC0ywKEqGtH8hAsBcjom6ZxAVq5E2Vgv9/zRsB9MqocWYcAMTWAwTFW9ys4/joS+HLTcwJpmgpwPp/btuVIezGyfmNES1gBYHxd19GQ7vueI/WzEYU4HKmJEVYDhmGwjAtYh4AacDgcOJVGsqgUstKuIzVhBYC/Ab6+WZZhvUyISwSIXf81ZgZEsitejexOoBDnuhNcaQH2ub8zcp1FgOPxKCtKkRjdOFrAG746+Pu4z9Q0AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIxLTEwLTA2VDAyOjU5OjI0KzAwOjAwdjZBPQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMS0xMC0wNlQwMjo1OToyNCswMDowMAdr+YEAAAAASUVORK5CYII="},{name:"lucy",img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAABICAMAAACHrYYZAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAclBMVEUAAABWWXJ6aGVnUVBGRl51ZGFOT2hjU1lfTlRAQFdCQllcS1ByXmODcnk8PFI6OlBHR19pVVNWWXJGRl7CiEvMllmzez+rZzavcjs6OlD/oKD2rp//y7A7eqJ3STTgcHC/ppDQvpxaZ3VqhJPHjFn///+qkMhRAAAAEnRSTlMAAAAAAAAAAAAAAAAAAAAAAACVcz0/AAAAAWJLR0QlwwHJDwAAAAd0SU1FB+UKBgMZFREdlEYAAAABb3JOVAHPoneaAAABUklEQVRIx+2W2VKDQBBFw74lIIoBwiKg//+NXudq1whK+ULnxfvCdM85KZgJxZxO//lzHMdxXffR5GkTz/N839cUQAdBALSqqmcrV5O6rtfO8UIYhqAxZ9OQKWBAR03AJYoi1Jxb0fwVCnEcfzjHC0mSoECraZrrT+Ez0AGsIKRp2rZt/ZWtJlPAACsIWZbxGbZpTOxnAKwg7NDc8tvtJk3ACoK9psLJ/6/rur7v0ZSV1RTkpskRZTBWFmwUpY2ivIvAgvc9DENvhaWyMI4j1xTdF5POinS42YB1BNzZNE32V3D7dQQATEc4n8+o53medgMAGGAFARfsJZ2dCKYmYC+xaly+VdCUl0RHuFwubCHLsmxPV2hyFmPACgJOA/j65nmO1usvwRQAYJ9njYMFpigKEeRNwEAEAN/OrVrCmwkGDyZ25y5CWZbcUQwKk1VHS3gHKAAJ6thLGQcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMTAtMDZUMDM6MjU6MTUrMDA6MDCwX2HiAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTEwLTA2VDAzOjI1OjE1KzAwOjAwwQLZXgAAAABJRU5ErkJggg=="},{name:"nancy",img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAABICAMAAACHrYYZAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAclBMVEUAAABWWXJlWWVUR1RGRl5kV2ROT2hVS1tRR1ZAQFdCQllORFNsXGNxYWiDcnk8PFI6OlBHR19KS2FWWXJGRl6DW0yGYVCAVElySkB7UUc6OlDyuJn/oKD/y7D2rp9kSULgcHBsboXY0OAqpeIzg9b////m8SWDAAAAE3RSTlMAAAAAAAAAAAAAAAAAAAAAAAAAZPGxjQAAAAFiS0dEJcMByQ8AAAAHdElNRQflCgUFKSsZAmxCAAAAAW9yTlQBz6J3mgAAAWNJREFUSMftlllThDAQhJdruQ9RXE5Z0P//G23T61QW1ipfGF/sB8LM9Eclk6qE0+lfv5bjOK7rPhu97OR5nu/7mgDcQRDA2jTNq6WLUdu2W+Z44Hw+w42a7QZMAC9k1AAMYRgiZm3j5lcIRFH0xRwPxHGMAKmu6y6PxDWQgVkBSJKk73umHjJIsgobzApAmqZcAwG7oZ2RvQaYFQBxQ8MwdJa45eM4igFmBUB6Ck3T9HavyUgMMGsCmPT0g+zN1gSwtaghtK0MeZzpA+wjmyuSXmsC8zxzAchejeydlgyXAbMOgJlt7sL97chQB8iyDMCyLEiRXNf13QgvkoQBQJ7nCgAG7CVqTPH5YSQhnjDAdjtmVADs5b650lCUeILoAEVRYOiNlm/RJyGrSMKsAOBvALdvWZZcA2cskgwMsN3+NQ4GqKqqbJPdUAqGu/9WLUCa+GRkZ/4EqOua08VLZbTJaAGfHgYMIaGaP2wAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMTAtMDVUMDU6NDE6MzIrMDA6MDBfrlkHAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTEwLTA1VDA1OjQxOjMyKzAwOjAwLvPhuwAAAABJRU5ErkJggg=="}];function $e(){var e=Object(n.useState)(""),t=Object(Ne.a)(e,2),a=t[0],r=t[1],i=Object(n.useState)(0),s=Object(Ne.a)(i,2),o=s[0],c=s[1],d=Object(n.useState)(!1),l=Object(Ne.a)(d,2),h=l[0],m=l[1],u=_e(),p=Te((function(e){return e.user.connected})),y=Te((function(e){return e.user.videoConnected}));return Object(Le.jsxs)(We,{children:[Object(Le.jsx)(Je,{children:"Welcome to TSC"}),Object(Le.jsxs)(Ze,{children:[Object(Le.jsxs)(Qe,{children:[Object(Le.jsx)(He,{children:"Select an avatar"}),Object(Le.jsx)(Ue.a,{navigation:!0,spaceBetween:0,slidesPerView:1,onSlideChange:function(e){var t;c(e.activeIndex),null===(t=Ee.scene.keys.game.myPlayer)||void 0===t||t.setPlayerTexture(qe[o].name)},children:qe.map((function(e){return Object(Le.jsx)(Ve.a,{children:Object(Le.jsx)("img",{src:e.img,alt:e.name})},e.name)}))})]}),Object(Le.jsxs)(ze,{children:[Object(Le.jsx)(Me.a,{autoFocus:!0,fullWidth:!0,label:"Name",variant:"outlined",color:"secondary",error:h,helperText:h&&"Name is required",onInput:function(e){(r(e.target.value),p)&&Ee.scene.keys.game.myPlayer.setPlayerName(a)}}),!y&&Object(Le.jsxs)(Xe,{children:[Object(Le.jsxs)(Be.a,{severity:"warning",children:[Object(Le.jsx)(Fe.a,{children:"Warning"}),"No webcam/mic connected - ",Object(Le.jsx)("strong",{children:"connect one for best experience!"})]}),Object(Le.jsx)(Ie.a,{variant:"outlined",color:"secondary",onClick:function(){var e;null===(e=Ee.scene.keys.game.network.webRTC)||void 0===e||e.getUserMedia()},children:"Connect Webcam"})]}),y&&Object(Le.jsx)(Xe,{children:Object(Le.jsx)(Be.a,{children:"Webcam connected!"})})]})]}),Object(Le.jsx)(Ke,{children:Object(Le.jsx)(Ie.a,{variant:"contained",color:"secondary",size:"large",onClick:function(){if(""===a)m(!0);else if(p){console.log("Join! Name:",a,"Avatar:",qe[o].name);var e=Ee.scene.keys.game;e.registerKeys(),e.myPlayer.setPlayerName(a),e.myPlayer.setPlayerTexture(qe[o].name),e.network.readyToConnect(),u(J(!0))}},children:"Join"})})]})}var et,tt,at,nt=a(31),rt=a(204),it=a(65),st=a.n(it),ot=a(116),ct=a(120),dt=["srcObject"];function lt(e){var t=e.srcObject,a=Object(ct.a)(e,dt),r=Object(n.useRef)(null);return Object(n.useEffect)((function(){r.current&&(r.current.srcObject=t)}),[t]),Object(Le.jsx)("video",Object(ot.a)({ref:r},a))}var ht,mt,ut=De.a.div(et||(et=Object(Pe.a)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  overflow: hidden;\n  padding: 16px 180px 16px 16px;\n"]))),pt=De.a.div(tt||(tt=Object(Pe.a)(["\n  width: 100%;\n  height: 100%;\n  background: #222639;\n  border-radius: 16px;\n  padding: 16px;\n  color: #eee;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n\n  .close {\n    position: absolute;\n    top: 16px;\n    right: 16px;\n  }\n"]))),yt=De.a.div(at||(at=Object(Pe.a)(["\n  flex: 1;\n  min-height: 0;\n  display: grid;\n  grid-gap: 10px;\n  grid-template-columns: repeat(auto-fit, minmax(40%, 1fr));\n\n  .video-container {\n    position: relative;\n    background: black;\n    border-radius: 8px;\n    overflow: hidden;\n\n    video {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      min-width: 0;\n      min-height: 0;\n      object-fit: contain;\n    }\n\n    .player-name {\n      position: absolute;\n      bottom: 16px;\n      left: 16px;\n      color: #fff;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      text-shadow: 0 1px 2px rgb(0 0 0 / 60%), 0 0 2px rgb(0 0 0 / 30%);\n      white-space: nowrap;\n    }\n  }\n"])));function At(e){var t=e.playerName,a=e.stream;return Object(Le.jsxs)("div",{className:"video-container",children:[Object(Le.jsx)(lt,{srcObject:a,autoPlay:!0}),t&&Object(Le.jsx)("div",{className:"player-name",children:t})]})}function ft(){var e=_e(),t=Te((function(e){return e.user.playerNameMap})),a=Te((function(e){return e.computer.shareScreenManager})),n=Te((function(e){return e.computer.myStream})),r=Te((function(e){return e.computer.peerStreams}));return Object(Le.jsx)(ut,{children:Object(Le.jsxs)(pt,{children:[Object(Le.jsx)(rt.a,{"aria-label":"close dialog",className:"close",onClick:function(){return e(R())},children:Object(Le.jsx)(st.a,{})}),Object(Le.jsx)("div",{className:"toolbar",children:Object(Le.jsx)(Ie.a,{variant:"contained",color:"secondary",onClick:function(){(null===a||void 0===a?void 0:a.myStream)?null===a||void 0===a||a.stopScreenShare():null===a||void 0===a||a.startScreenShare()},children:(null===a||void 0===a?void 0:a.myStream)?"Stop sharing":"Share Screen"})}),Object(Le.jsxs)(yt,{children:[n&&Object(Le.jsx)(At,{stream:n,playerName:"You"}),Object(nt.a)(r.entries()).map((function(e){var a=Object(Ne.a)(e,2),n=a[0],r=a[1].stream,i=t.get(n);return Object(Le.jsx)(At,{playerName:i,stream:r},n)}))]})]})})}var vt,gt,bt,Ot=De.a.div(ht||(ht=Object(Pe.a)(["\n  position: fixed;\n  top: 0;\n"]))),jt=De.a.div(mt||(mt=Object(Pe.a)(["\n  width: 100%;\n  height: 100%;\n  padding: 16px;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n"])));function xt(){var e=Object(n.useState)(!0),t=Object(Ne.a)(e,2),a=t[0],r=t[1];return Object(Le.jsx)(Ot,{children:Object(Le.jsxs)(jt,{children:[a&&Object(Le.jsxs)(Be.a,{severity:"warning",onClose:function(){r(!a)},children:[Object(Le.jsx)(Fe.a,{children:"Warning"}),"No webcam connected",Object(Le.jsx)("br",{})," ",Object(Le.jsx)("strong",{children:"connect one for full experience!"})]}),Object(Le.jsx)(Ie.a,{variant:"contained",color:"secondary",onClick:function(){var e;null===(e=Ee.scene.keys.game.network.webRTC)||void 0===e||e.getUserMedia()},children:"Connect Webcam"})]})})}var kt=De.a.div(vt||(vt=Object(Pe.a)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  overflow: hidden;\n  padding: 16px 180px 16px 16px;\n"]))),wt=De.a.div(gt||(gt=Object(Pe.a)(["\n  width: 100%;\n  height: 100%;\n  background: #222639;\n  border-radius: 16px;\n  padding: 16px;\n  color: #eee;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n\n  .close {\n    position: absolute;\n    top: 16px;\n    right: 16px;\n  }\n"]))),Ct=De.a.div(bt||(bt=Object(Pe.a)(["\n  flex: 1;\n  border-radius: 25px;\n  overflow: hidden;\n  margin-right: 50px;\n  iframe {\n    width: 100%;\n    height: 100%;\n  }\n"])));function Et(){var e=_e();return Object(Le.jsx)(kt,{children:Object(Le.jsxs)(wt,{children:[Object(Le.jsx)(rt.a,{"aria-label":"close dialog",className:"close",onClick:function(){return e(F())},children:Object(Le.jsx)(st.a,{})}),Object(Le.jsx)(Ct,{children:Object(Le.jsx)("iframe",{title:"white board",src:"https://app.tryeraser.com/"})})]})})}var St,Rt,_t,Tt,Nt,Pt,Dt,Mt=a(206),It=a(208),Bt=a(202),Ft=a(207),Ut=a(34),Vt=a(117),Gt=a.n(Vt),Yt=(a(149),a(118)),Lt=De.a.div(St||(St=Object(Pe.a)(["\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  height: 420px;\n  width: 560px;\n  max-height: 50%;\n  max-width: 50%;\n"]))),Wt=De.a.div(Rt||(Rt=Object(Pe.a)(["\n  height: 100%;\n  padding: 16px;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n"]))),Jt=De.a.div(_t||(_t=Object(Pe.a)(["\n  margin-top: auto;\n"]))),Ht=De.a.div(Tt||(Tt=Object(Pe.a)(["\n  height: 35px;\n  background: #000000a7;\n  /* background: linear-gradient(0deg, #000000a7, #2424249e); */\n  border-radius: 10px 10px 0px 0px;\n\n  h3 {\n    color: #fff;\n    margin: 7px;\n    font-size: 17px;\n    text-align: center;\n  }\n\n  .close {\n    position: absolute;\n    top: 15px;\n    right: 15px;\n  }\n"]))),Zt=Object(De.a)(Mt.a)(Nt||(Nt=Object(Pe.a)(["\n  height: 100%;\n  width: 100%;\n  overflow: auto;\n  background: #000000a7;\n  background: #2c2c2c;\n  border: 1px solid #00000029;\n  /* border: 1px solid #5e696b; */\n"]))),Qt=De.a.div(Pt||(Pt=Object(Pe.a)(["\n  box-shadow: 10px 10px 10px #00000018;\n  border: 1px solid #42eacb;\n  border-radius: 0px 0px 10px 10px;\n  display: flex;\n  flex-direction: row;\n  background: linear-gradient(180deg, #000000c1, #242424c0);\n"]))),zt=Object(De.a)(Ut.c)(Dt||(Dt=Object(Pe.a)(["\n  border-radius: 0px 0px 10px 10px;\n  input {\n    padding: 5px;\n    font-size: 15;\n  }\n"]))),Kt=["#7bf1a8","#ff7e50","#9acd32","#daa520","#ff69b4","#c085f6"],Xt=new Intl.DateTimeFormat("en",{timeStyle:"short",dateStyle:"short"});function qt(){var e=Te((function(e){return e.chat.messages})),t=r.a.useState(""),a=Object(Ne.a)(t,2),i=a[0],s=a[1],o=r.a.useState(!0),c=Object(Ne.a)(o,2),d=c[0],l=c[1],h=r.a.useState(!1),m=Object(Ne.a)(h,2),u=m[0],p=m[1],y=Object(n.useRef)(null),A=Object(n.useRef)(""),f=Ee.scene.keys.game,v=function(e){13===e.keyCode&&(f.network.onChatMessage(A.current),A.current="",s(""))};return r.a.useEffect((function(){var e=y.current,t=((null===e||void 0===e?void 0:e.scrollHeight)||0)-((null===e||void 0===e?void 0:e.clientHeight)||0);e.scrollTop=t>0?t:0}),[e]),r.a.useEffect((function(){return document.addEventListener("keydown",v,!1),function(){document.removeEventListener("keydown",v,!1)}}),[]),Object(Le.jsx)(Le.Fragment,{children:Object(Le.jsx)(Lt,{children:Object(Le.jsx)(Wt,{children:d?Object(Le.jsxs)(Le.Fragment,{children:[Object(Le.jsxs)(Ht,{children:[Object(Le.jsx)("h3",{children:"Chat"}),Object(Le.jsx)(rt.a,{"aria-label":"close dialog",className:"close",onClick:function(){return l(!d)},size:"small",children:Object(Le.jsx)(st.a,{})})]}),Object(Le.jsxs)(Zt,{ref:y,children:[Object(Le.jsx)(Bt.a,{children:e.map((function(e,t){var a=e.content,n=e.name;return Object(Le.jsxs)(r.a.Fragment,{children:[Object(Le.jsx)(Ft.a,{style:{color:"#d1cfcf",margin:"7px",textShadow:"0.3px 0.3px black",fontSize:14},children:Xt.format(Date.now())}),Object(Le.jsxs)("p",{style:{color:Kt[Math.floor(Math.random()*Kt.length)],margin:"7px",textShadow:"0.3px 0.3px black",fontSize:15,fontWeight:"bold",lineHeight:1.4},children:["".concat(n," "),Object(Le.jsx)("span",{style:{color:"white",fontWeight:"normal"},children:a})," "]})]},t)}))}),u&&Object(Le.jsx)(Yt.a,{theme:"dark",showSkinTones:!1,showPreview:!1,style:{position:"absolute",bottom:"58px",right:"16px"},onSelect:function(e){s("hihi "+e.native),p(!u)},exclude:["recent","flags"]})]}),Object(Le.jsx)(Qt,{children:Object(Le.jsx)(zt,{autoFocus:!0,fullWidth:!0,placeholder:"Aa",value:i,onChange:function(e){s(e.target.value),A.current=e.target.value}})})]}):Object(Le.jsx)(Jt,{children:Object(Le.jsx)(It.a,{color:"secondary","aria-label":"showChat",onClick:function(){l(!d)},children:Object(Le.jsx)(Gt.a,{})})})})})})}var $t=function(){var e=Te((function(e){return e.user.loggedIn})),t=Te((function(e){return e.computer.computerDialogOpen})),a=Te((function(e){return e.user.videoConnected})),n=Te((function(e){return e.whiteboard.whiteboardDialogOpen}));return Object(Le.jsxs)("div",{className:"App",children:[e?Object(Le.jsx)(qt,{}):Object(Le.jsx)($e,{}),t&&Object(Le.jsx)(ft,{}),!t&&!a&&e&&Object(Le.jsx)(xt,{}),n&&Object(Le.jsx)(Et,{})]})},ea=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,210)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,i=t.getLCP,s=t.getTTFB;a(e),n(e),r(e),i(e),s(e)}))};s.a.render(Object(Le.jsx)(r.a.StrictMode,{children:Object(Le.jsx)(o.a,{store:$,children:Object(Le.jsx)(c.a,{theme:Re,children:Object(Le.jsx)($t,{})})})}),document.getElementById("root")),ea()}},[[151,1,2]]]);
//# sourceMappingURL=main.79ef6738.chunk.js.map