{"version":3,"sources":["../node_modules/peerjs/dist sync","anims/CharacterAnims.ts","web/ShareScreenManager.ts","util.ts","stores/ComputerStore.ts","stores/WhiteboardStore.ts","stores/UserStore.ts","stores/ChatStore.ts","stores/index.ts","../../types/PlayerBehavior.ts","items/Item.ts","events/EventCenter.ts","characters/Player.ts","characters/MyPlayer.ts","characters/OtherPlayer.ts","../../types/Messages.ts","characters/PlayerSelector.ts","web/WebRTC.ts","services/Network.ts","scenes/Game.ts","scenes/Preloader.ts","PhaserGame.ts","MuiTheme.js","hooks.ts","components/LoginDialog.tsx","assets/Adam_login.png","assets/Ash_login.png","assets/Lucy_login.png","assets/Nancy_login.png","components/Video.tsx","components/ComputerDialog.tsx","components/VideoConnectionDialog.tsx","components/WhiteboardDialog.tsx","components/Chat.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","createCharacterAnims","anims","animsFrameRate","create","key","frames","generateFrameNames","start","end","repeat","frameRate","ShareScreenManager","userId","myPeer","myStream","sanatizedId","this","makeId","Peer","on","err","console","log","type","error","call","answer","userVideoStream","store","dispatch","addVideoStream","peer","stream","removeVideoStream","disconnected","reconnect","stopScreenShare","disconnect","replace","navigator","mediaDevices","getDisplayMedia","video","audio","then","track","getVideoTracks","onended","setMyStream","computerItem","phaserGame","scene","game","computerMap","get","getState","computer","computerId","currentUsers","onUserJoined","shouldDispatch","getTracks","forEach","stop","undefined","network","onStopScreenShare","sanitizeId","sanitized","length","endsWith","substring","initialState","computerDialogOpen","peerStreams","Map","shareScreenManager","computerSlice","createSlice","name","reducers","openComputerDialog","state","action","payload","myUserId","onOpen","closeComputerDialog","disconnectFromComputer","values","close","onClose","clear","set","delete","actions","whiteboardSlice","whiteboardDialogOpen","openWhiteboardDialog","closeWhiteboardDialog","userSlice","sessionId","connected","videoConnected","loggedIn","playerNameMap","setSessionId","setConnected","setVideoConnected","setLoggedIn","setPlayerNameMap","removePlayerNameMap","chatSlice","messages","addMessage","push","enableMapSet","PlayerBehavior","configureStore","reducer","user","userReducer","computerReducer","whiteboard","whiteboardReducer","chat","chatReducer","middleware","getDefaultMiddleware","serializableCheck","Item","x","y","texture","frame","dialogBox","statusBox","itemDirection","Array","add","container","setDepth","setDialogBox","text","duration","innerText","setFontFamily","setFontSize","setColor","dialogBoxWidth","getBounds","width","dialogBoxHeight","height","dialogBoxX","dialogBoxY","graphics","fillStyle","fillRoundedRect","lineStyle","strokeRoundedRect","setPosition","removeAll","statusBoxWidth","statusBoxHeight","statusBoxX","statusBoxY","computerState","index","indexOf","splice","onUserLeft","numberOfUsers","clearStatusBox","setStatusBox","Phaser","Physics","Arcade","Sprite","Event","phaserEvents","Events","EventEmitter","sittingShiftData","up","down","left","right","Player","playerId","playerTexture","playerBehavior","IDLE","readyToConnect","playerName","playerNameContainer","play","setOrigin","physics","world","enable","collisionScale","body","setSize","setOffset","setText","emit","MY_PLAYER_NAME_CHANGE","MY_PLAYER_TEXTURE_CHANGE","currentAnim","MyPlayer","playNameContainerBody","itemOnSit","playerSelector","cursors","keyE","keyR","item","selectedItem","Input","Keyboard","JustDown","connectToComputer","time","addEvent","delay","callback","setVelocity","depth","updatePlayer","loop","clearDialogBox","SITTING","speed","vx","vy","isDown","velocity","setLength","parts","split","newAnim","join","update","GameObjects","GameObjectFactory","register","sprite","displayList","updateList","enableBody","DYNAMIC_BODY","OtherPlayer","targetPosition","lastUpdateTimestamp","connectionBufferTime","myPlayer","webRTC","myPlayerId","connectToNewUser","field","value","fromScene","destroy","t","dt","animParts","animDir","delta","dx","dy","Math","abs","embedded","touching","none","PLAYER_DISCONNECTED","Message","PlayerSelector","existing","player","overlap","Zone","WebRTC","peers","onCalledVideos","videoGrid","document","querySelector","buttonGrid","myVideo","createElement","sanitizedId","replaceInvalidId","muted","initialize","permissions","query","result","getUserMedia","remove","setUpButtons","catch","window","alert","has","srcObject","addEventListener","append","peerCall","audioButton","audioTrack","getAudioTracks","enabled","videoButton","Network","client","room","mySessionId","location","protocol","Client","updatePlayerName","playerStreamDisconnect","a","joinOrCreate","players","onAdd","PLAYER_JOINED","onChange","changes","change","PLAYER_UPDATED","onRemove","PLAYER_LEFT","deleteVideoStream","deleteOnCalledVideoStream","computers","connectedUser","ITEM_USER_ADDED","ITEM_USER_REMOVED","chatMessages","message","onMessage","DISCONNECT_STREAM","clientId","STOP_SCREEN_SHARE","context","MY_PLAYER_READY","MY_PLAYER_VIDEO_CONNECTED","currentX","currentY","send","UPDATE_PLAYER","anim","currentName","UPDATE_PLAYER_NAME","READY_TO_CONNECT","VIDEO_CONNECTED","CONNECT_TO_COMPUTER","DISCONNECT_FROM_COMPUTER","ADD_CHAT_MESSAGE","content","Game","map","items","otherPlayers","otherPlayerMap","input","keyboard","createCursorKeys","addKey","make","tilemap","FloorAndGround","addTilesetImage","groundLayer","createLayer","setCollisionByProperty","collides","addGroupFromTiled","staticGroup","classType","getObjectLayer","objects","chairObj","addObjectFromTiled","properties","computerLayer","counter","Obj","String","scale","group","cameras","main","zoom","startFollow","collider","handleItemSelectorOverlap","handlePlayersOverlap","onPlayerJoined","handlePlayerJoined","onPlayerLeft","handlePlayerLeft","onMyPlayerReady","handleMyPlayerReady","onMyPlayerVideoConnected","handleMyVideoConnected","onPlayerUpdated","handlePlayerUpdated","onItemUserAdded","handleItemUserAdded","onItemUserRemoved","handleItemUserRemoved","selectionItem","currentItem","onOverlapDialog","object","tilesetName","actualX","actualY","gid","getTileset","firstgid","objectLayerName","collidable","newPlayer","otherPlayer","updateOtherPlayer","makeCall","itemId","addCurrentUser","updateStatus","removeCurrentUser","Scene","Preloader","load","tilemapTiledJSON","spritesheet","frameWidth","frameHeight","screenCenterX","worldView","screenCenterY","loadingText","run","config","AUTO","parent","backgroundColor","pixelArt","mode","Scale","ScaleModes","RESIZE","innerWidth","innerHeight","default","arcade","gravity","debug","autoFocus","muiTheme","createTheme","palette","primary","secondary","useAppDispatch","useDispatch","useAppSelector","useSelector","SwiperCore","use","Navigation","Wrapper","styled","div","Title","h1","SubTitle","h3","Content","Left","Right","Bottom","Warning","avatars","img","LoginDialog","useState","setName","avatarIndex","setAvatarIndex","nameFieldEmpty","setNameFieldEmpty","navigation","spaceBetween","slidesPerView","onSlideChange","swiper","activeIndex","setPlayerTexture","avatar","src","alt","TextField","fullWidth","label","variant","color","helperText","onInput","target","setPlayerName","Alert","severity","AlertTitle","Button","onClick","size","registerKeys","Video","props","refVideo","useRef","useEffect","current","ref","Backdrop","VideoGrid","VideoContainer","className","autoPlay","ComputerDialog","IconButton","startScreenShare","entries","VideoConnectionDialog","connectionWarning","setConnectionWarning","WhiteboardWrapper","WhiteboardDialog","title","FabWrapper","ChatHeader","ChatBox","Box","InputWrapper","InputTextField","InputBase","colorArr","o","Intl","DateTimeFormat","timeStyle","dateStyle","Chat","React","setValue","showChat","setShowChat","showEmojiPicker","setShowEmojiPicker","messageRef","_handleEnterKey","event","keyCode","onChatMessage","chatRef","maxScrollTop","scrollHeight","clientHeight","scrollTop","removeEventListener","List","Fragment","Divider","style","margin","textShadow","fontSize","format","Date","now","floor","random","fontWeight","lineHeight","theme","showSkinTones","showPreview","position","bottom","onSelect","emoji","native","exclude","placeholder","Fab","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","ThemeProvider","getElementById"],"mappings":"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","file":"static/js/main.23079a65.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 142;","import Phaser from 'phaser'\r\n\r\nexport const createCharacterAnims = (anims: Phaser.Animations.AnimationManager) => {\r\n  const animsFrameRate = 15\r\n\r\n  anims.create({\r\n    key: 'nancy_idle_right',\r\n    frames: anims.generateFrameNames('nancy', {\r\n      start: 0,\r\n      end: 5,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'nancy_idle_up',\r\n    frames: anims.generateFrameNames('nancy', {\r\n      start: 6,\r\n      end: 11,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'nancy_idle_left',\r\n    frames: anims.generateFrameNames('nancy', {\r\n      start: 12,\r\n      end: 17,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'nancy_idle_down',\r\n    frames: anims.generateFrameNames('nancy', {\r\n      start: 18,\r\n      end: 23,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'nancy_run_right',\r\n    frames: anims.generateFrameNames('nancy', {\r\n      start: 24,\r\n      end: 29,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'nancy_run_up',\r\n    frames: anims.generateFrameNames('nancy', {\r\n      start: 30,\r\n      end: 35,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'nancy_run_left',\r\n    frames: anims.generateFrameNames('nancy', {\r\n      start: 36,\r\n      end: 41,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'nancy_run_down',\r\n    frames: anims.generateFrameNames('nancy', {\r\n      start: 42,\r\n      end: 47,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'nancy_sit_down',\r\n    frames: anims.generateFrameNames('nancy', {\r\n      start: 48,\r\n      end: 48,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'nancy_sit_left',\r\n    frames: anims.generateFrameNames('nancy', {\r\n      start: 49,\r\n      end: 49,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'nancy_sit_right',\r\n    frames: anims.generateFrameNames('nancy', {\r\n      start: 50,\r\n      end: 50,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'nancy_sit_up',\r\n    frames: anims.generateFrameNames('nancy', {\r\n      start: 51,\r\n      end: 51,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'lucy_idle_right',\r\n    frames: anims.generateFrameNames('lucy', {\r\n      start: 0,\r\n      end: 5,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'lucy_idle_up',\r\n    frames: anims.generateFrameNames('lucy', {\r\n      start: 6,\r\n      end: 11,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'lucy_idle_left',\r\n    frames: anims.generateFrameNames('lucy', {\r\n      start: 12,\r\n      end: 17,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'lucy_idle_down',\r\n    frames: anims.generateFrameNames('lucy', {\r\n      start: 18,\r\n      end: 23,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'lucy_run_right',\r\n    frames: anims.generateFrameNames('lucy', {\r\n      start: 24,\r\n      end: 29,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'lucy_run_up',\r\n    frames: anims.generateFrameNames('lucy', {\r\n      start: 30,\r\n      end: 35,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'lucy_run_left',\r\n    frames: anims.generateFrameNames('lucy', {\r\n      start: 36,\r\n      end: 41,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'lucy_run_down',\r\n    frames: anims.generateFrameNames('lucy', {\r\n      start: 42,\r\n      end: 47,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'lucy_sit_down',\r\n    frames: anims.generateFrameNames('lucy', {\r\n      start: 48,\r\n      end: 48,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'lucy_sit_left',\r\n    frames: anims.generateFrameNames('lucy', {\r\n      start: 49,\r\n      end: 49,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'lucy_sit_right',\r\n    frames: anims.generateFrameNames('lucy', {\r\n      start: 50,\r\n      end: 50,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'lucy_sit_up',\r\n    frames: anims.generateFrameNames('lucy', {\r\n      start: 51,\r\n      end: 51,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'ash_idle_right',\r\n    frames: anims.generateFrameNames('ash', {\r\n      start: 0,\r\n      end: 5,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'ash_idle_up',\r\n    frames: anims.generateFrameNames('ash', {\r\n      start: 6,\r\n      end: 11,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'ash_idle_left',\r\n    frames: anims.generateFrameNames('ash', {\r\n      start: 12,\r\n      end: 17,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'ash_idle_down',\r\n    frames: anims.generateFrameNames('ash', {\r\n      start: 18,\r\n      end: 23,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'ash_run_right',\r\n    frames: anims.generateFrameNames('ash', {\r\n      start: 24,\r\n      end: 29,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'ash_run_up',\r\n    frames: anims.generateFrameNames('ash', {\r\n      start: 30,\r\n      end: 35,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'ash_run_left',\r\n    frames: anims.generateFrameNames('ash', {\r\n      start: 36,\r\n      end: 41,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'ash_run_down',\r\n    frames: anims.generateFrameNames('ash', {\r\n      start: 42,\r\n      end: 47,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'ash_sit_down',\r\n    frames: anims.generateFrameNames('ash', {\r\n      start: 48,\r\n      end: 48,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'ash_sit_left',\r\n    frames: anims.generateFrameNames('ash', {\r\n      start: 49,\r\n      end: 49,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'ash_sit_right',\r\n    frames: anims.generateFrameNames('ash', {\r\n      start: 50,\r\n      end: 50,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'ash_sit_up',\r\n    frames: anims.generateFrameNames('ash', {\r\n      start: 51,\r\n      end: 51,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'adam_idle_right',\r\n    frames: anims.generateFrameNames('adam', {\r\n      start: 0,\r\n      end: 5,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'adam_idle_up',\r\n    frames: anims.generateFrameNames('adam', {\r\n      start: 6,\r\n      end: 11,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'adam_idle_left',\r\n    frames: anims.generateFrameNames('adam', {\r\n      start: 12,\r\n      end: 17,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'adam_idle_down',\r\n    frames: anims.generateFrameNames('adam', {\r\n      start: 18,\r\n      end: 23,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate * 0.6,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'adam_run_right',\r\n    frames: anims.generateFrameNames('adam', {\r\n      start: 24,\r\n      end: 29,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'adam_run_up',\r\n    frames: anims.generateFrameNames('adam', {\r\n      start: 30,\r\n      end: 35,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'adam_run_left',\r\n    frames: anims.generateFrameNames('adam', {\r\n      start: 36,\r\n      end: 41,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'adam_run_down',\r\n    frames: anims.generateFrameNames('adam', {\r\n      start: 42,\r\n      end: 47,\r\n    }),\r\n    repeat: -1,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'adam_sit_down',\r\n    frames: anims.generateFrameNames('adam', {\r\n      start: 48,\r\n      end: 48,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'adam_sit_left',\r\n    frames: anims.generateFrameNames('adam', {\r\n      start: 49,\r\n      end: 49,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'adam_sit_right',\r\n    frames: anims.generateFrameNames('adam', {\r\n      start: 50,\r\n      end: 50,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n\r\n  anims.create({\r\n    key: 'adam_sit_up',\r\n    frames: anims.generateFrameNames('adam', {\r\n      start: 51,\r\n      end: 51,\r\n    }),\r\n    repeat: 0,\r\n    frameRate: animsFrameRate,\r\n  })\r\n}\r\n","import Peer from 'peerjs'\r\nimport store from '../stores'\r\nimport { setMyStream, addVideoStream, removeVideoStream } from '../stores/ComputerStore'\r\nimport phaserGame from '../PhaserGame'\r\nimport Game from '../scenes/Game'\r\n\r\nexport default class ShareScreenManager {\r\n  private myPeer: Peer\r\n  myStream?: MediaStream\r\n\r\n  constructor(private userId: string) {\r\n    const sanatizedId = this.makeId(userId)\r\n    this.myPeer = new Peer(sanatizedId)\r\n    this.myPeer.on('error', (err) => {\r\n      console.log('ShareScreenWebRTC err.type', err.type)\r\n      console.error('ShareScreenWebRTC', err)\r\n    })\r\n\r\n    this.myPeer.on('call', (call) => {\r\n      call.answer()\r\n\r\n      call.on('stream', (userVideoStream) => {\r\n        store.dispatch(addVideoStream({ id: call.peer, call, stream: userVideoStream }))\r\n      })\r\n      // triggered only when the connected peer is destroyed\r\n      call.on('closed', () => {\r\n        store.dispatch(removeVideoStream(call.peer))\r\n      })\r\n    })\r\n  }\r\n\r\n  onOpen() {\r\n    if (this.myPeer.disconnected) {\r\n      this.myPeer.reconnect()\r\n    }\r\n  }\r\n\r\n  onClose() {\r\n    this.stopScreenShare(false)\r\n    this.myPeer.disconnect()\r\n  }\r\n\r\n  // PeerJS throws invalid_id error if it contains some characters such as that colyseus generates.\r\n  // https://peerjs.com/docs.html#peer-id\r\n  // Also for screen sharing ID add a `-ss` at the end.\r\n  private makeId(id: string) {\r\n    return `${id.replace(/[^0-9a-z]/gi, 'G')}-ss`\r\n  }\r\n\r\n  startScreenShare() {\r\n    navigator.mediaDevices\r\n      ?.getDisplayMedia({\r\n        video: true,\r\n        audio: true,\r\n      })\r\n      .then((stream) => {\r\n        // Detect when user clicks \"Stop sharing\" outside of our UI.\r\n        // https://stackoverflow.com/a/25179198\r\n        const track = stream.getVideoTracks()[0]\r\n        if (track) {\r\n          track.onended = () => {\r\n            this.stopScreenShare()\r\n          }\r\n        }\r\n\r\n        this.myStream = stream\r\n        store.dispatch(setMyStream(stream))\r\n\r\n        // Call all existing users.\r\n        const game = phaserGame.scene.keys.game as Game\r\n        const computerItem = game.computerMap.get(store.getState().computer.computerId!)\r\n        if (computerItem) {\r\n          for (const userId of computerItem.currentUsers) {\r\n            this.onUserJoined(userId)\r\n          }\r\n        }\r\n      })\r\n  }\r\n\r\n  // TODO(daxchen): Fix this trash hack, if we call store.dispatch here when calling\r\n  // from onClose, it causes redux reducer cycle, this may be fixable by using thunk\r\n  // or something.\r\n  stopScreenShare(shouldDispatch = true) {\r\n    this.myStream?.getTracks().forEach((track) => track.stop())\r\n    this.myStream = undefined\r\n    if (shouldDispatch) {\r\n      store.dispatch(setMyStream(null))\r\n      // Manually let all other existing users know screen sharing is stopped\r\n      const game = phaserGame.scene.keys.game as Game\r\n      game.network.onStopScreenShare(store.getState().computer.computerId!)\r\n    }\r\n  }\r\n\r\n  onUserJoined(userId: string) {\r\n    if (!this.myStream || userId === this.userId) return\r\n\r\n    const sanatizedId = this.makeId(userId)\r\n    this.myPeer.call(sanatizedId, this.myStream)\r\n  }\r\n\r\n  onUserLeft(userId: string) {\r\n    if (userId === this.userId) return\r\n\r\n    const sanatizedId = this.makeId(userId)\r\n    store.dispatch(removeVideoStream(sanatizedId))\r\n  }\r\n}\r\n","export function sanitizeId(id: string) {\r\n  let sanitized = id\r\n\r\n  if (sanitized.length > 9 && sanitized.endsWith('-ss')) {\r\n    sanitized = sanitized.substring(0, sanitized.length - 3)\r\n  }\r\n\r\n  return sanitized.replace(/[^0-9a-z]/gi, 'G')\r\n}\r\n","import Peer from 'peerjs'\r\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit'\r\nimport ShareScreenManager from '../web/ShareScreenManager'\r\nimport phaserGame from '../PhaserGame'\r\nimport Game from '../scenes/Game'\r\nimport { sanitizeId } from '../util'\r\n\r\ninterface ComputerState {\r\n  computerDialogOpen: boolean\r\n  computerId: null | string\r\n  myStream: null | MediaStream\r\n  peerStreams: Map<\r\n    string,\r\n    {\r\n      stream: MediaStream\r\n      call: Peer.MediaConnection\r\n    }\r\n  >\r\n  shareScreenManager: null | ShareScreenManager\r\n}\r\n\r\nconst initialState: ComputerState = {\r\n  computerDialogOpen: false,\r\n  computerId: null,\r\n  myStream: null,\r\n  peerStreams: new Map(),\r\n  shareScreenManager: null,\r\n}\r\n\r\nexport const computerSlice = createSlice({\r\n  name: 'computer',\r\n  initialState,\r\n  reducers: {\r\n    openComputerDialog: (\r\n      state,\r\n      action: PayloadAction<{ computerId: string; myUserId: string }>\r\n    ) => {\r\n      if (!state.shareScreenManager) {\r\n        state.shareScreenManager = new ShareScreenManager(action.payload.myUserId)\r\n      }\r\n      state.shareScreenManager.onOpen()\r\n      state.computerDialogOpen = true\r\n      state.computerId = action.payload.computerId\r\n    },\r\n    closeComputerDialog: (state) => {\r\n      // Tell server the computer dialog is closed.\r\n      const game = phaserGame.scene.keys.game as Game\r\n      game.network.disconnectFromComputer(state.computerId!)\r\n      for (const { call } of state.peerStreams.values()) {\r\n        call.close()\r\n      }\r\n      state.shareScreenManager?.onClose()\r\n      state.computerDialogOpen = false\r\n      state.myStream = null\r\n      state.computerId = null\r\n      state.peerStreams.clear()\r\n    },\r\n    setMyStream: (state, action: PayloadAction<null | MediaStream>) => {\r\n      state.myStream = action.payload\r\n    },\r\n    addVideoStream: (\r\n      state,\r\n      action: PayloadAction<{ id: string; call: Peer.MediaConnection; stream: MediaStream }>\r\n    ) => {\r\n      state.peerStreams.set(sanitizeId(action.payload.id), {\r\n        call: action.payload.call,\r\n        stream: action.payload.stream,\r\n      })\r\n    },\r\n    removeVideoStream: (state, action: PayloadAction<string>) => {\r\n      state.peerStreams.delete(sanitizeId(action.payload))\r\n    },\r\n  },\r\n})\r\n\r\nexport const {\r\n  closeComputerDialog,\r\n  openComputerDialog,\r\n  setMyStream,\r\n  addVideoStream,\r\n  removeVideoStream,\r\n} = computerSlice.actions\r\n\r\nexport default computerSlice.reducer\r\n","import { createSlice } from '@reduxjs/toolkit'\r\n\r\ninterface WhiteboardState {\r\n  whiteboardDialogOpen: boolean\r\n}\r\n\r\nconst initialState: WhiteboardState = {\r\n  whiteboardDialogOpen: false,\r\n}\r\n\r\nexport const whiteboardSlice = createSlice({\r\n  name: 'whiteboard',\r\n  initialState,\r\n  reducers: {\r\n    openWhiteboardDialog: (state) => {\r\n      state.whiteboardDialogOpen = true\r\n    },\r\n    closeWhiteboardDialog: (state) => {\r\n      state.whiteboardDialogOpen = false\r\n    },\r\n  },\r\n})\r\n\r\nexport const { openWhiteboardDialog, closeWhiteboardDialog } = whiteboardSlice.actions\r\n\r\nexport default whiteboardSlice.reducer\r\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit'\r\nimport { sanitizeId } from '../util'\r\n\r\nexport const userSlice = createSlice({\r\n  name: 'user',\r\n  initialState: {\r\n    sessionId: '',\r\n    connected: false,\r\n    videoConnected: false,\r\n    loggedIn: false,\r\n    playerNameMap: new Map<string, string>(),\r\n  },\r\n  reducers: {\r\n    setSessionId: (state, action: PayloadAction<string>) => {\r\n      state.sessionId = action.payload\r\n    },\r\n    setConnected: (state, action: PayloadAction<boolean>) => {\r\n      state.connected = action.payload\r\n    },\r\n    setVideoConnected: (state, action: PayloadAction<boolean>) => {\r\n      state.videoConnected = action.payload\r\n    },\r\n    setLoggedIn: (state, action: PayloadAction<boolean>) => {\r\n      state.loggedIn = action.payload\r\n    },\r\n    setPlayerNameMap: (state, action: PayloadAction<{ id: string; name: string }>) => {\r\n      state.playerNameMap.set(sanitizeId(action.payload.id), action.payload.name)\r\n    },\r\n    removePlayerNameMap: (state, action: PayloadAction<string>) => {\r\n      state.playerNameMap.delete(sanitizeId(action.payload))\r\n    },\r\n  },\r\n})\r\n\r\nexport const {\r\n  setSessionId,\r\n  setConnected,\r\n  setVideoConnected,\r\n  setLoggedIn,\r\n  setPlayerNameMap,\r\n  removePlayerNameMap,\r\n} = userSlice.actions\r\n\r\nexport default userSlice.reducer\r\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit'\r\nimport { IChatMessage } from '../../../types/IOfficeState'\r\n\r\ninterface MessageState {\r\n  messages: IChatMessage[]\r\n}\r\n\r\nconst initialState: MessageState = {\r\n  messages: []\r\n}\r\n\r\nexport const chatSlice = createSlice({\r\n  name: 'chat',\r\n  initialState,\r\n  reducers: {\r\n    addMessage: (state, action: PayloadAction<IChatMessage>) => {\r\n      state.messages.push(action.payload)\r\n    }\r\n  }\r\n})\r\n\r\nexport const {\r\n  addMessage,\r\n} = chatSlice.actions\r\n\r\nexport default chatSlice.reducer\r\n","import { enableMapSet } from 'immer'\r\nimport { configureStore } from '@reduxjs/toolkit'\r\nimport computerReducer from './ComputerStore'\r\nimport whiteboardReducer from './WhiteboardStore'\r\nimport userReducer from './UserStore'\r\nimport chatReducer from './ChatStore'\r\n\r\nenableMapSet()\r\n\r\nconst store = configureStore({\r\n  reducer: {\r\n    user: userReducer,\r\n    computer: computerReducer,\r\n    whiteboard: whiteboardReducer,\r\n    chat: chatReducer\r\n  },\r\n  // Temporary disable serialize check for redux as we store MediaStream in ComputerStore.\r\n  // https://stackoverflow.com/a/63244831\r\n  middleware: (getDefaultMiddleware) =>\r\n    getDefaultMiddleware({\r\n      serializableCheck: false,\r\n    }),\r\n})\r\n\r\n// Infer the `RootState` and `AppDispatch` types from the store itself\r\nexport type RootState = ReturnType<typeof store.getState>\r\n// Inferred type: {posts: PostsState, comments: CommentsState, users: UsersState}\r\nexport type AppDispatch = typeof store.dispatch\r\n\r\nexport default store\r\n","export enum PlayerBehavior {\r\n  IDLE,\r\n  SITTING,\r\n}\r\n","import Phaser from 'phaser'\r\nimport store from '../stores'\r\n\r\nexport default class Item extends Phaser.Physics.Arcade.Sprite {\r\n  private dialogBox!: Phaser.GameObjects.Container\r\n  private statusBox!: Phaser.GameObjects.Container\r\n  itemDirection?: string\r\n  id?: string\r\n  currentUsers = new Array<string>()\r\n\r\n  constructor(scene: Phaser.Scene, x: number, y: number, texture: string, frame?: string | number) {\r\n    super(scene, x, y, texture, frame)\r\n\r\n    // add dialogBox and statusBox containers on top of everything which we can add text in later\r\n    this.dialogBox = this.scene.add.container().setDepth(10000)\r\n    this.statusBox = this.scene.add.container().setDepth(10000)\r\n  }\r\n\r\n  onOverlapDialog() {\r\n    switch (this.texture.key) {\r\n      case 'chairs':\r\n        this.setDialogBox('Press E to sit')\r\n        break\r\n\r\n      case 'computers':\r\n        if (this.currentUsers.length === 0) {\r\n          this.setDialogBox('Press R to use computer')\r\n        } else {\r\n          this.setDialogBox('Press R join')\r\n        }\r\n        break\r\n\r\n      case 'whiteboards':\r\n        this.setDialogBox('Press R to use whiteboard', 145)\r\n        break\r\n    }\r\n  }\r\n\r\n  // add texts into dialog box container\r\n  setDialogBox(text: string, duration?: number) {\r\n    const innerText = this.scene.add\r\n      .text(0, 0, text)\r\n      .setFontFamily('Arial')\r\n      .setFontSize(12)\r\n      .setColor('#000000')\r\n\r\n    // set dialogBox slightly larger than the text in it\r\n    const dialogBoxWidth = innerText.getBounds().width + 4\r\n    const dialogBoxHeight = innerText.getBounds().height + 2\r\n    const dialogBoxX = this.x - dialogBoxWidth * 0.5\r\n    const dialogBoxY = this.y + this.height * 0.5\r\n\r\n    this.dialogBox.add(\r\n      this.scene.add\r\n        .graphics()\r\n        .fillStyle(0xffffff, 1)\r\n        .fillRoundedRect(dialogBoxX, dialogBoxY, dialogBoxWidth, dialogBoxHeight, 3)\r\n        .lineStyle(2, 0x000000, 1)\r\n        .strokeRoundedRect(dialogBoxX, dialogBoxY, dialogBoxWidth, dialogBoxHeight, 3)\r\n    )\r\n    this.dialogBox.add(innerText.setPosition(dialogBoxX + 2, dialogBoxY))\r\n  }\r\n\r\n  // remove everything in the dialog box container\r\n  clearDialogBox() {\r\n    this.dialogBox.removeAll(true)\r\n  }\r\n\r\n  // add text into status box container\r\n  setStatusBox(text: string) {\r\n    const innerText = this.scene.add\r\n      .text(0, 0, text)\r\n      .setFontFamily('Arial')\r\n      .setFontSize(12)\r\n      .setColor('#000000')\r\n\r\n    // set dialogBox slightly larger than the text in it\r\n    const statusBoxWidth = innerText.getBounds().width + 4\r\n    const statusBoxHeight = innerText.getBounds().height + 2\r\n    const statusBoxX = this.x - statusBoxWidth * 0.5\r\n    const statusBoxY = this.y - this.height * 0.25\r\n    this.statusBox.add(\r\n      this.scene.add\r\n        .graphics()\r\n        .fillStyle(0xffffff, 1)\r\n        .fillRoundedRect(statusBoxX, statusBoxY, statusBoxWidth, statusBoxHeight, 3)\r\n        .lineStyle(2, 0x000000, 1)\r\n        .strokeRoundedRect(statusBoxX, statusBoxY, statusBoxWidth, statusBoxHeight, 3)\r\n    )\r\n    this.statusBox.add(innerText.setPosition(statusBoxX + 2, statusBoxY))\r\n  }\r\n\r\n  // remove everything in the status box container\r\n  clearStatusBox() {\r\n    this.statusBox.removeAll(true)\r\n  }\r\n\r\n  addCurrentUser(userId: string) {\r\n    this.currentUsers?.push(userId)\r\n    const computerState = store.getState().computer\r\n    if (computerState.computerId === this.id) {\r\n      computerState.shareScreenManager?.onUserJoined(userId)\r\n    }\r\n  }\r\n\r\n  removeCurrentUser(userId: string) {\r\n    if (this.currentUsers) {\r\n      const index = this.currentUsers.indexOf(userId)\r\n      if (index > -1) {\r\n        this.currentUsers.splice(index, 1)\r\n\r\n        const computerState = store.getState().computer\r\n        if (computerState.computerId === this.id) {\r\n          computerState.shareScreenManager?.onUserLeft(userId)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  updateStatus() {\r\n    const numberOfUsers = this.currentUsers.length\r\n    this.clearStatusBox()\r\n    if (numberOfUsers === 1) {\r\n      this.setStatusBox(`${numberOfUsers} user`)\r\n    } else if (numberOfUsers > 1) {\r\n      this.setStatusBox(`${numberOfUsers} users`)\r\n    }\r\n  }\r\n}\r\n","import Phaser from 'phaser'\r\n\r\nexport const phaserEvents = new Phaser.Events.EventEmitter()\r\n\r\nexport enum Event {\r\n  PLAYER_JOINED = 'player-joined',\r\n  PLAYER_UPDATED = 'player-updated',\r\n  PLAYER_LEFT = 'player-left',\r\n  PLAYER_DISCONNECTED = 'player-disconnected',\r\n  MY_PLAYER_READY = 'my-player-ready',\r\n  MY_PLAYER_NAME_CHANGE = 'my-player-name-change',\r\n  MY_PLAYER_TEXTURE_CHANGE = 'my-player-texture-change',\r\n  MY_PLAYER_VIDEO_CONNECTED = 'my-player-video-connected',\r\n  ITEM_USER_ADDED = 'item-user-added',\r\n  ITEM_USER_REMOVED = 'item-user-removed',\r\n}\r\n","import Phaser from 'phaser'\r\nimport { PlayerBehavior } from '../../../types/PlayerBehavior'\r\nimport { phaserEvents, Event } from '../events/EventCenter'\r\n/**\r\n * shifting distance for sitting animation\r\n * format: direction: [xShift, yShift, depthShift]\r\n */\r\nexport const sittingShiftData = {\r\n  up: [0, 3, -10],\r\n  down: [0, 3, 1],\r\n  left: [0, -8, 10],\r\n  right: [0, -8, 10],\r\n}\r\n\r\nexport default class Player extends Phaser.Physics.Arcade.Sprite {\r\n  playerId: string\r\n  playerTexture: string\r\n  playerBehavior = PlayerBehavior.IDLE\r\n  readyToConnect = false\r\n  videoConnected = false\r\n  playerName: Phaser.GameObjects.Text\r\n  playerNameContainer: Phaser.GameObjects.Container\r\n\r\n  constructor(\r\n    scene: Phaser.Scene,\r\n    x: number,\r\n    y: number,\r\n    texture: string,\r\n    id: string,\r\n    frame?: string | number\r\n  ) {\r\n    super(scene, x, y, texture, frame)\r\n\r\n    this.playerId = id\r\n    this.playerTexture = texture\r\n    this.setDepth(this.y)\r\n    this.playerNameContainer = this.scene.add.container(this.x, this.y - 30).setDepth(5000)\r\n\r\n    this.anims.play(`${this.playerTexture}_idle_down`, true)\r\n\r\n    this.playerName = this.scene.add\r\n      .text(0, 0, '')\r\n      .setFontFamily('Arial')\r\n      .setFontSize(12)\r\n      .setColor('#000000')\r\n      .setOrigin(0.5)\r\n\r\n    this.playerNameContainer.add(this.playerName)\r\n    this.scene.physics.world.enable(this.playerNameContainer)\r\n    const playNameContainerBody = this.playerNameContainer.body as Phaser.Physics.Arcade.Body\r\n    const collisionScale = [0.5, 0.2]\r\n    playNameContainerBody\r\n      .setSize(this.width * collisionScale[0], this.height * collisionScale[1])\r\n      .setOffset(-8, this.height * (1 - collisionScale[1]) + 6)\r\n  }\r\n\r\n  setPlayerName(name: string) {\r\n    this.playerName.setText(name)\r\n    phaserEvents.emit(Event.MY_PLAYER_NAME_CHANGE, name)\r\n  }\r\n\r\n  setPlayerTexture(texture: string) {\r\n    this.playerTexture = texture\r\n    this.anims.play(`${this.playerTexture}_idle_down`, true)\r\n    phaserEvents.emit(Event.MY_PLAYER_TEXTURE_CHANGE, this.x, this.y, this.anims.currentAnim.key)\r\n  }\r\n}\r\n","import Phaser from 'phaser'\r\nimport PlayerSelector from './PlayerSelector'\r\nimport { PlayerBehavior } from '../../../types/PlayerBehavior'\r\nimport { sittingShiftData } from './Player'\r\nimport Player from './Player'\r\nimport Network from '../services/Network'\r\nimport Item from '../items/Item'\r\nimport store from '../stores'\r\nimport { openComputerDialog } from '../stores/ComputerStore'\r\nimport { openWhiteboardDialog } from '../stores/WhiteboardStore'\r\n\r\nexport default class MyPlayer extends Player {\r\n  private playNameContainerBody: Phaser.Physics.Arcade.Body\r\n  private itemOnSit?: Item\r\n  constructor(\r\n    scene: Phaser.Scene,\r\n    x: number,\r\n    y: number,\r\n    texture: string,\r\n    id: string,\r\n    frame?: string | number\r\n  ) {\r\n    super(scene, x, y, texture, id, frame)\r\n    this.playNameContainerBody = this.playerNameContainer.body as Phaser.Physics.Arcade.Body\r\n  }\r\n\r\n  update(\r\n    playerSelector: PlayerSelector,\r\n    cursors: Phaser.Types.Input.Keyboard.CursorKeys,\r\n    keyE: Phaser.Input.Keyboard.Key,\r\n    keyR: Phaser.Input.Keyboard.Key,\r\n    network: Network\r\n  ) {\r\n    if (!cursors) return\r\n\r\n    const item = playerSelector.selectedItem\r\n\r\n    if (Phaser.Input.Keyboard.JustDown(keyR)) {\r\n      switch (item?.texture.key) {\r\n        case 'computers':\r\n          if (item.id) {\r\n            store.dispatch(openComputerDialog({ computerId: item.id, myUserId: this.playerId }))\r\n            network.connectToComputer(item.id)\r\n          }\r\n          break\r\n\r\n        case 'whiteboards':\r\n          store.dispatch(openWhiteboardDialog())\r\n          break\r\n      }\r\n    }\r\n\r\n    switch (this.playerBehavior) {\r\n      case PlayerBehavior.IDLE:\r\n        // if press E in front of selected chair\r\n        if (Phaser.Input.Keyboard.JustDown(keyE) && item?.texture.key === 'chairs') {\r\n          /**\r\n           * move player to the chair and play sit animation\r\n           * a delay is called to wait for player movement (from previous velocity) to end\r\n           * as the player tends to move one more frame before sitting down causing player\r\n           * not sitting at the center of the chair\r\n           */\r\n          this.scene.time.addEvent({\r\n            delay: 10,\r\n            callback: () => {\r\n              // update character velocity and position\r\n              this.setVelocity(0, 0)\r\n              if (item.itemDirection) {\r\n                this.setPosition(\r\n                  item.x + sittingShiftData[item.itemDirection][0],\r\n                  item.y + sittingShiftData[item.itemDirection][1]\r\n                ).setDepth(item.depth + sittingShiftData[item.itemDirection][2])\r\n                // also update playerNameContainer velocity and position\r\n                this.playNameContainerBody.setVelocity(0, 0)\r\n                this.playerNameContainer.setPosition(\r\n                  item.x + sittingShiftData[item.itemDirection][0],\r\n                  item.y + sittingShiftData[item.itemDirection][1] - 30\r\n                )\r\n              }\r\n\r\n              this.play(`${this.playerTexture}_sit_${item.itemDirection}`, true)\r\n              playerSelector.selectedItem = undefined\r\n              playerSelector.setPosition(this.x, this.y - this.height)\r\n              // playerSelector.setPosition(0, 0)\r\n              // send new location and anim to server\r\n              network.updatePlayer(this.x, this.y, this.anims.currentAnim.key)\r\n            },\r\n            loop: false,\r\n          })\r\n          // set up new dialog as player sits down\r\n          item.clearDialogBox()\r\n          item.setDialogBox('Press E to leave')\r\n          this.itemOnSit = item\r\n          this.playerBehavior = PlayerBehavior.SITTING\r\n          return\r\n        }\r\n\r\n        const speed = 200\r\n        let vx = 0\r\n        let vy = 0\r\n        if (cursors.left?.isDown) vx -= speed\r\n        if (cursors.right?.isDown) vx += speed\r\n        if (cursors.up?.isDown) {\r\n          vy -= speed\r\n          this.setDepth(this.y) //change player.depth if player.y changes\r\n        }\r\n        if (cursors.down?.isDown) {\r\n          vy += speed\r\n          this.setDepth(this.y) //change player.depth if player.y changes\r\n        }\r\n        // update character velocity\r\n        this.setVelocity(vx, vy)\r\n        this.body.velocity.setLength(speed)\r\n        // also update playerNameContainer velocity\r\n        this.playNameContainerBody.setVelocity(vx, vy)\r\n        this.playNameContainerBody.velocity.setLength(speed)\r\n\r\n        // update animation according to velocity and send new location and anim to server\r\n        if (vx !== 0 || vy !== 0) network.updatePlayer(this.x, this.y, this.anims.currentAnim.key)\r\n        if (vx > 0) {\r\n          this.play(`${this.playerTexture}_run_right`, true)\r\n        } else if (vx < 0) {\r\n          this.play(`${this.playerTexture}_run_left`, true)\r\n        } else if (vy > 0) {\r\n          this.play(`${this.playerTexture}_run_down`, true)\r\n        } else if (vy < 0) {\r\n          this.play(`${this.playerTexture}_run_up`, true)\r\n        } else {\r\n          const parts = this.anims.currentAnim.key.split('_')\r\n          parts[1] = 'idle'\r\n          const newAnim = parts.join('_')\r\n          // this prevents idle animation keeps getting called\r\n          if (this.anims.currentAnim.key !== newAnim) {\r\n            this.play(parts.join('_'), true)\r\n            // send new location and anim to server\r\n            network.updatePlayer(this.x, this.y, this.anims.currentAnim.key)\r\n          }\r\n        }\r\n        break\r\n\r\n      case PlayerBehavior.SITTING:\r\n        // back to idle if player press E while sitting\r\n        if (Phaser.Input.Keyboard.JustDown(keyE)) {\r\n          const parts = this.anims.currentAnim.key.split('_')\r\n          parts[1] = 'idle'\r\n          this.play(parts.join('_'), true)\r\n          this.playerBehavior = PlayerBehavior.IDLE\r\n          this.itemOnSit?.clearDialogBox()\r\n          playerSelector.setPosition(this.x, this.y)\r\n          playerSelector.update(this, cursors)\r\n          network.updatePlayer(this.x, this.y, this.anims.currentAnim.key)\r\n        }\r\n        break\r\n    }\r\n  }\r\n}\r\n\r\ndeclare global {\r\n  namespace Phaser.GameObjects {\r\n    interface GameObjectFactory {\r\n      myPlayer(x: number, y: number, texture: string, id: string, frame?: string | number): MyPlayer\r\n    }\r\n  }\r\n}\r\n\r\nPhaser.GameObjects.GameObjectFactory.register(\r\n  'myPlayer',\r\n  function (\r\n    this: Phaser.GameObjects.GameObjectFactory,\r\n    x: number,\r\n    y: number,\r\n    texture: string,\r\n    id: string,\r\n    frame?: string | number\r\n  ) {\r\n    const sprite = new MyPlayer(this.scene, x, y, texture, id, frame)\r\n\r\n    this.displayList.add(sprite)\r\n    this.updateList.add(sprite)\r\n\r\n    this.scene.physics.world.enableBody(sprite, Phaser.Physics.Arcade.DYNAMIC_BODY)\r\n\r\n    const collisionScale = [0.5, 0.2]\r\n    sprite.body\r\n      .setSize(sprite.width * collisionScale[0], sprite.height * collisionScale[1])\r\n      .setOffset(\r\n        sprite.width * (1 - collisionScale[0]) * 0.5,\r\n        sprite.height * (1 - collisionScale[1])\r\n      )\r\n\r\n    return sprite\r\n  }\r\n)\r\n","import Phaser from 'phaser'\r\nimport Player from './Player'\r\nimport MyPlayer from './MyPlayer'\r\nimport { sittingShiftData } from './Player'\r\nimport WebRTC from '../web/WebRTC'\r\nimport { Event, phaserEvents } from '../events/EventCenter'\r\n\r\nexport default class OtherPlayer extends Player {\r\n  private targetPosition: [number, number]\r\n  private lastUpdateTimestamp?: number\r\n  private connectionBufferTime = 0\r\n  private connected = false\r\n  private playNameContainerBody: Phaser.Physics.Arcade.Body\r\n  private myPlayer?: MyPlayer\r\n\r\n  constructor(\r\n    scene: Phaser.Scene,\r\n    x: number,\r\n    y: number,\r\n    texture: string,\r\n    id: string,\r\n    name: string,\r\n    frame?: string | number\r\n  ) {\r\n    super(scene, x, y, texture, id, frame)\r\n    this.targetPosition = [x, y]\r\n\r\n    this.playerName.setText(name)\r\n    this.playNameContainerBody = this.playerNameContainer.body as Phaser.Physics.Arcade.Body\r\n  }\r\n\r\n  makeCall(myPlayer: MyPlayer, webRTC: WebRTC) {\r\n    this.myPlayer = myPlayer\r\n    const myPlayerId = myPlayer.playerId\r\n    if (\r\n      !this.connected &&\r\n      this.connectionBufferTime >= 750 &&\r\n      myPlayer.readyToConnect &&\r\n      this.readyToConnect\r\n    ) {\r\n      if (\r\n        (myPlayer.videoConnected && !this.videoConnected) ||\r\n        (myPlayer.videoConnected && this.videoConnected && myPlayerId > this.playerId)\r\n      ) {\r\n        webRTC.connectToNewUser(this.playerId)\r\n        this.connected = true\r\n        this.connectionBufferTime = 0\r\n      }\r\n    }\r\n  }\r\n\r\n  updateOtherPlayer(field: string, value: number | string | boolean) {\r\n    switch (field) {\r\n      case 'name':\r\n        if (typeof value === 'string') {\r\n          this.playerName.setText(value)\r\n        }\r\n        break\r\n\r\n      case 'x':\r\n        if (typeof value === 'number') {\r\n          this.targetPosition[0] = value\r\n        }\r\n        break\r\n\r\n      case 'y':\r\n        if (typeof value === 'number') {\r\n          this.targetPosition[1] = value\r\n        }\r\n        break\r\n\r\n      case 'anim':\r\n        if (typeof value === 'string') {\r\n          this.anims.play(value, true)\r\n        }\r\n        break\r\n\r\n      case 'readyToConnect':\r\n        if (typeof value === 'boolean') {\r\n          this.readyToConnect = value\r\n        }\r\n        break\r\n\r\n      case 'videoConnected':\r\n        if (typeof value === 'boolean') {\r\n          this.videoConnected = value\r\n        }\r\n        break\r\n    }\r\n  }\r\n\r\n  destroy(fromScene?: boolean) {\r\n    this.playerNameContainer.destroy()\r\n\r\n    super.destroy(fromScene)\r\n  }\r\n\r\n  /** preUpdate is called every frame for every game object. */\r\n  preUpdate(t: number, dt: number) {\r\n    super.preUpdate(t, dt)\r\n\r\n    // if Phaser has not updated the canvas (when the game tab is not active) for more than 1 sec\r\n    // directly snap player to their current locations\r\n    if (this.lastUpdateTimestamp && t - this.lastUpdateTimestamp > 750) {\r\n      this.lastUpdateTimestamp = t\r\n      this.x = this.targetPosition[0]\r\n      this.y = this.targetPosition[1]\r\n      this.playerNameContainer.x = this.targetPosition[0]\r\n      this.playerNameContainer.y = this.targetPosition[1] - 30\r\n      return\r\n    }\r\n\r\n    this.lastUpdateTimestamp = t\r\n    this.setDepth(this.y) // change player.depth based on player.y\r\n    const animParts = this.anims.currentAnim.key.split('_')\r\n    const animState = animParts[1]\r\n    if (animState === 'sit') {\r\n      const animDir = animParts[2]\r\n      const sittingShift = sittingShiftData[animDir]\r\n      if (sittingShift) {\r\n        // set hardcoded depth (differs between directions) if player sits down\r\n        this.setDepth(this.depth + sittingShiftData[animDir][2])\r\n      }\r\n    }\r\n\r\n    const speed = 200 // speed is in unit of pixels per second\r\n    const delta = (speed / 1000) * dt // minimum distance that a player can move in a frame (dt is in unit of ms)\r\n    let dx = this.targetPosition[0] - this.x\r\n    let dy = this.targetPosition[1] - this.y\r\n\r\n    // if the player is close enough to the target position, directly snap the player to that position\r\n    if (Math.abs(dx) < delta) {\r\n      this.x = this.targetPosition[0]\r\n      this.playerNameContainer.x = this.targetPosition[0]\r\n      dx = 0\r\n    }\r\n    if (Math.abs(dy) < delta) {\r\n      this.y = this.targetPosition[1]\r\n      this.playerNameContainer.y = this.targetPosition[1] - 30\r\n      dy = 0\r\n    }\r\n\r\n    // if the player is still far from target position, impose a constant velocity towards it\r\n    let vx = 0\r\n    let vy = 0\r\n    if (dx > 0) vx += speed\r\n    else if (dx < 0) vx -= speed\r\n    if (dy > 0) vy += speed\r\n    else if (dy < 0) vy -= speed\r\n\r\n    // update character velocity\r\n    this.setVelocity(vx, vy)\r\n    this.body.velocity.setLength(speed)\r\n    // also update playerNameContainer velocity\r\n    this.playNameContainerBody.setVelocity(vx, vy)\r\n    this.playNameContainerBody.velocity.setLength(speed)\r\n\r\n    // while currently connected with myPlayer\r\n    // if myPlayer and the otherPlayer stop overlapping, delete video stream\r\n    this.connectionBufferTime += dt\r\n    if (\r\n      this.connected &&\r\n      !this.body.embedded &&\r\n      this.body.touching.none &&\r\n      this.connectionBufferTime >= 750\r\n    ) {\r\n      if (this.x < 610 && this.y > 515 && this.myPlayer!.x < 610 && this.myPlayer!.y > 515) return\r\n      phaserEvents.emit(Event.PLAYER_DISCONNECTED, this.playerId)\r\n      this.connectionBufferTime = 0\r\n      this.connected = false\r\n    }\r\n  }\r\n}\r\n\r\ndeclare global {\r\n  namespace Phaser.GameObjects {\r\n    interface GameObjectFactory {\r\n      otherPlayer(\r\n        x: number,\r\n        y: number,\r\n        texture: string,\r\n        id: string,\r\n        name: string,\r\n        frame?: string | number\r\n      ): OtherPlayer\r\n    }\r\n  }\r\n}\r\n\r\nPhaser.GameObjects.GameObjectFactory.register(\r\n  'otherPlayer',\r\n  function (\r\n    this: Phaser.GameObjects.GameObjectFactory,\r\n    x: number,\r\n    y: number,\r\n    texture: string,\r\n    id: string,\r\n    name: string,\r\n    frame?: string | number\r\n  ) {\r\n    const sprite = new OtherPlayer(this.scene, x, y, texture, id, name, frame)\r\n\r\n    this.displayList.add(sprite)\r\n    this.updateList.add(sprite)\r\n\r\n    this.scene.physics.world.enableBody(sprite, Phaser.Physics.Arcade.DYNAMIC_BODY)\r\n\r\n    const collisionScale = [6, 4]\r\n    sprite.body\r\n      .setSize(sprite.width * collisionScale[0], sprite.height * collisionScale[1])\r\n      .setOffset(\r\n        sprite.width * (1 - collisionScale[0]) * 0.5,\r\n        sprite.height * (1 - collisionScale[1]) * 0.5 + 17\r\n      )\r\n\r\n    return sprite\r\n  }\r\n)\r\n","export enum Message {\r\n  UPDATE_PLAYER,\r\n  UPDATE_PLAYER_NAME,\r\n  READY_TO_CONNECT,\r\n  DISCONNECT_STREAM,\r\n  CONNECT_TO_COMPUTER,\r\n  DISCONNECT_FROM_COMPUTER,\r\n  STOP_SCREEN_SHARE,\r\n  VIDEO_CONNECTED,\r\n  ADD_CHAT_MESSAGE,\r\n}\r\n","import Phaser from 'phaser'\r\nimport MyPlayer from './MyPlayer'\r\nimport { PlayerBehavior } from '../../../types/PlayerBehavior'\r\nimport Item from '../items/Item'\r\n\r\nexport default class PlayerSelector extends Phaser.GameObjects.Zone {\r\n  selectedItem?: Item\r\n\r\n  constructor(scene: Phaser.Scene, x: number, y: number, width: number, height: number) {\r\n    super(scene, x, y, width, height)\r\n\r\n    scene.physics.add.existing(this)\r\n  }\r\n\r\n  update(player: MyPlayer, cursors: Phaser.Types.Input.Keyboard.CursorKeys) {\r\n    if (!cursors) {\r\n      return\r\n    }\r\n\r\n    // no need to update player selection while sitting\r\n    if (player.playerBehavior === PlayerBehavior.SITTING) {\r\n      return\r\n    }\r\n\r\n    // update player selection box position so that it's always in front of the player\r\n    const { x, y } = player\r\n    if (cursors.left?.isDown) {\r\n      this.setPosition(x - 32, y)\r\n    } else if (cursors.right?.isDown) {\r\n      this.setPosition(x + 32, y)\r\n    } else if (cursors.up?.isDown) {\r\n      this.setPosition(x, y - 32)\r\n    } else if (cursors.down?.isDown) {\r\n      this.setPosition(x, y + 32)\r\n    }\r\n\r\n    // while currently selecting an item,\r\n    // if the selector and selection item stop overlapping, clear the dialog box and selected item\r\n    if (this.selectedItem) {\r\n      if (!this.scene.physics.overlap(this, this.selectedItem)) {\r\n        this.selectedItem.clearDialogBox()\r\n        this.selectedItem = undefined\r\n      }\r\n    }\r\n  }\r\n}\r\n","import Peer from 'peerjs'\r\nimport Network from '../services/Network'\r\nimport store from '../stores'\r\nimport { setVideoConnected } from '../stores/UserStore'\r\n\r\nexport default class WebRTC {\r\n  private myPeer: Peer\r\n  peers = new Map<string, Peer.MediaConnection>()\r\n  onCalledVideos = new Map<string, HTMLVideoElement>()\r\n  private videoGrid = document.querySelector('.video-grid')\r\n  private buttonGrid = document.querySelector('.button-grid')\r\n  private myVideo = document.createElement('video')\r\n  private myStream?: MediaStream\r\n  private network: Network\r\n\r\n  constructor(userId: string, network: Network) {\r\n    const sanitizedId = this.replaceInvalidId(userId)\r\n    this.myPeer = new Peer(sanitizedId)\r\n    this.network = network\r\n    console.log('userId:', userId)\r\n    console.log('sanitizedId:', sanitizedId)\r\n    this.myPeer.on('error', (err) => {\r\n      console.log(err.type)\r\n      console.log(err)\r\n    })\r\n\r\n    // mute your own video stream (you don't want to hear yourself)\r\n    this.myVideo.muted = true\r\n\r\n    // config peerJS\r\n    this.initialize()\r\n\r\n    // if permission has been granted before\r\n    const permissionName = 'microphone' as PermissionName\r\n    navigator.permissions.query({ name: permissionName }).then((result) => {\r\n      if (result.state === 'granted') this.getUserMedia()\r\n    })\r\n  }\r\n\r\n  // PeerJS throws invalid_id error if it contains some characters such as that colyseus generates.\r\n  // https://peerjs.com/docs.html#peer-id\r\n  private replaceInvalidId(userId: string) {\r\n    return userId.replace(/[^0-9a-z]/gi, 'G')\r\n  }\r\n\r\n  initialize() {\r\n    this.myPeer.on('call', (call) => {\r\n      call.answer(this.myStream)\r\n      const video = document.createElement('video')\r\n\r\n      call.on('stream', (userVideoStream) => {\r\n        this.addVideoStream(video, userVideoStream)\r\n      })\r\n      // triggered only when the connected peer is destroyed\r\n      call.on('closed', () => {\r\n        video.remove()\r\n        this.onCalledVideos.delete(call.peer)\r\n      })\r\n      call.on('error', (err) => {\r\n        console.log(err)\r\n      })\r\n      this.onCalledVideos.set(call.peer, video)\r\n    })\r\n  }\r\n\r\n  getUserMedia() {\r\n    // ask the browser to get user media\r\n    navigator.mediaDevices\r\n      ?.getUserMedia({\r\n        video: true,\r\n        audio: true,\r\n      })\r\n      .then((stream) => {\r\n        this.myStream = stream\r\n        this.addVideoStream(this.myVideo, this.myStream)\r\n        this.setUpButtons()\r\n        store.dispatch(setVideoConnected(true))\r\n        this.network.videoConnected()\r\n      })\r\n      .catch((error) => {\r\n        store.dispatch(setVideoConnected(false))\r\n        window.alert('No webcam or microphone found, or permission is blocked')\r\n      })\r\n  }\r\n\r\n  // method to call a peer\r\n  connectToNewUser(userId: string) {\r\n    console.log('calling')\r\n    if (this.myStream) {\r\n      const sanitizedId = this.replaceInvalidId(userId)\r\n      if (!this.onCalledVideos.has(sanitizedId)) {\r\n        const call = this.myPeer.call(sanitizedId, this.myStream)\r\n        const video = document.createElement('video')\r\n        call.on('stream', (userVideoStream) => {\r\n          this.addVideoStream(video, userVideoStream)\r\n        })\r\n        call.on('close', () => {\r\n          video.remove()\r\n        })\r\n        this.peers.set(sanitizedId, call)\r\n      }\r\n    }\r\n  }\r\n\r\n  // method to add new video stream to videoGrid div\r\n  addVideoStream(video: HTMLVideoElement, stream: MediaStream) {\r\n    video.srcObject = stream\r\n    video.addEventListener('loadedmetadata', () => {\r\n      video.play()\r\n    })\r\n    if (this.videoGrid) this.videoGrid.append(video)\r\n  }\r\n\r\n  // method to remove video stream (when we are the host of the call)\r\n  deleteVideoStream(userId: string) {\r\n    const sanitizedId = this.replaceInvalidId(userId)\r\n    if (this.peers.has(sanitizedId)) {\r\n      const peerCall = this.peers.get(sanitizedId)\r\n      peerCall?.close()\r\n      this.peers.delete(sanitizedId)\r\n    }\r\n  }\r\n\r\n  // method to remove video stream (when we are the guest of the call)\r\n  deleteOnCalledVideoStream(userId: string) {\r\n    const sanitizedId = this.replaceInvalidId(userId)\r\n    if (this.onCalledVideos.has(sanitizedId)) {\r\n      const video = this.onCalledVideos.get(sanitizedId)\r\n      video?.remove()\r\n      this.onCalledVideos.delete(sanitizedId)\r\n    }\r\n  }\r\n\r\n  // method to set up mute/unmute and video on/off buttons\r\n  setUpButtons() {\r\n    const audioButton = document.createElement('button')\r\n    audioButton.innerText = 'Mute'\r\n    audioButton.addEventListener('click', () => {\r\n      if (this.myStream) {\r\n        const audioTrack = this.myStream.getAudioTracks()[0]\r\n        if (audioTrack.enabled) {\r\n          audioTrack.enabled = false\r\n          audioButton.innerText = 'Unmute'\r\n        } else {\r\n          audioTrack.enabled = true\r\n          audioButton.innerText = 'Mute'\r\n        }\r\n      }\r\n    })\r\n    const videoButton = document.createElement('button')\r\n    videoButton.innerText = 'Video off'\r\n    videoButton.addEventListener('click', () => {\r\n      if (this.myStream) {\r\n        const audioTrack = this.myStream.getVideoTracks()[0]\r\n        if (audioTrack.enabled) {\r\n          audioTrack.enabled = false\r\n          videoButton.innerText = 'Video on'\r\n        } else {\r\n          audioTrack.enabled = true\r\n          videoButton.innerText = 'Video off'\r\n        }\r\n      }\r\n    })\r\n    this.buttonGrid?.append(audioButton)\r\n    this.buttonGrid?.append(videoButton)\r\n  }\r\n}\r\n","import { IChatMessage } from './../../../types/IOfficeState'\r\nimport { Client, Room } from 'colyseus.js'\r\nimport { IComputer, IOfficeState, IPlayer } from '../../../types/IOfficeState'\r\nimport { Message } from '../../../types/Messages'\r\nimport WebRTC from '../web/WebRTC'\r\nimport { phaserEvents, Event } from '../events/EventCenter'\r\nimport store from '../stores'\r\nimport { setSessionId, setPlayerNameMap, removePlayerNameMap } from '../stores/UserStore'\r\nimport { addMessage } from '../stores/ChatStore'\r\n\r\nexport default class Network {\r\n  private client: Client\r\n  private room?: Room<IOfficeState>\r\n  webRTC?: WebRTC\r\n\r\n  mySessionId!: string\r\n\r\n  constructor() {\r\n    const protocol = window.location.protocol.replace('http', 'ws')\r\n    const endpoint =\r\n      process.env.NODE_ENV === 'production'\r\n        ? `wss://tsc-verse.herokuapp.com`\r\n        : `${protocol}//${window.location.hostname}:2567`\r\n    this.client = new Client(endpoint)\r\n\r\n    phaserEvents.on(Event.MY_PLAYER_NAME_CHANGE, this.updatePlayerName, this)\r\n    phaserEvents.on(Event.MY_PLAYER_TEXTURE_CHANGE, this.updatePlayer, this)\r\n    phaserEvents.on(Event.PLAYER_DISCONNECTED, this.playerStreamDisconnect, this)\r\n  }\r\n\r\n  async join() {\r\n    this.room = await this.client.joinOrCreate('skyoffice')\r\n    this.mySessionId = this.room.sessionId\r\n    store.dispatch(setSessionId(this.room.sessionId))\r\n    this.webRTC = new WebRTC(this.mySessionId, this)\r\n\r\n    // new instance added to the players MapSchema\r\n    this.room.state.players.onAdd = (player: IPlayer, key: string) => {\r\n      if (key === this.mySessionId) return\r\n\r\n      phaserEvents.emit(Event.PLAYER_JOINED, player, key)\r\n\r\n      // track changes on every child object inside the players MapSchema\r\n      player.onChange = (changes) => {\r\n        changes.forEach((change) => {\r\n          const { field, value } = change\r\n          phaserEvents.emit(Event.PLAYER_UPDATED, field, value, key)\r\n          if (field === 'name') {\r\n            store.dispatch(setPlayerNameMap({ id: key, name: value }))\r\n          }\r\n        })\r\n      }\r\n    }\r\n\r\n    // an instance removed from the players MapSchema\r\n    this.room.state.players.onRemove = (player: IPlayer, key: string) => {\r\n      phaserEvents.emit(Event.PLAYER_LEFT, key)\r\n      this.webRTC?.deleteVideoStream(key)\r\n      this.webRTC?.deleteOnCalledVideoStream(key)\r\n      store.dispatch(removePlayerNameMap(key))\r\n    }\r\n\r\n    // new instance added to the computers MapSchema\r\n    this.room.state.computers.onAdd = (computer: IComputer, key: string) => {\r\n      // track changes on every child object's connectedUser\r\n      computer.connectedUser.onAdd = (item, index) => {\r\n        phaserEvents.emit(Event.ITEM_USER_ADDED, item, key)\r\n      }\r\n      computer.connectedUser.onRemove = (item, index) => {\r\n        phaserEvents.emit(Event.ITEM_USER_REMOVED, item, key)\r\n      }\r\n    }\r\n\r\n    // new message added to the chat store\r\n    this.room.state.chatMessages.onAdd = (message: IChatMessage, key: number) => {\r\n      store.dispatch(addMessage(message))\r\n    }\r\n\r\n\r\n    // when a peer disconnect with myPeer\r\n    this.room.onMessage(Message.DISCONNECT_STREAM, (clientId: string) => {\r\n      this.webRTC?.deleteOnCalledVideoStream(clientId)\r\n    })\r\n\r\n    // when a computer user stops sharing screen\r\n    this.room.onMessage(Message.STOP_SCREEN_SHARE, (clientId: string) => {\r\n      const computerState = store.getState().computer\r\n      computerState.shareScreenManager?.onUserLeft(clientId)\r\n    })\r\n  }\r\n\r\n  // method to register event listener and call back function when a item user added\r\n  onItemUserAdded(callback: (playerId: string, key: string) => void, context?: any) {\r\n    phaserEvents.on(Event.ITEM_USER_ADDED, callback, context)\r\n  }\r\n\r\n  // method to register event listener and call back function when a item user removed\r\n  onItemUserRemoved(callback: (playerId: string, key: string) => void, context?: any) {\r\n    phaserEvents.on(Event.ITEM_USER_REMOVED, callback, context)\r\n  }\r\n\r\n  // method to register event listener and call back function when a player joined\r\n  onPlayerJoined(callback: (Player: IPlayer, key: string) => void, context?: any) {\r\n    phaserEvents.on(Event.PLAYER_JOINED, callback, context)\r\n  }\r\n\r\n  // method to register event listener and call back function when a player left\r\n  onPlayerLeft(callback: (key: string) => void, context?: any) {\r\n    phaserEvents.on(Event.PLAYER_LEFT, callback, context)\r\n  }\r\n\r\n  // method to register event listener and call back function when myPlayer is ready to connect\r\n  onMyPlayerReady(callback: (key: string) => void, context?: any) {\r\n    phaserEvents.on(Event.MY_PLAYER_READY, callback, context)\r\n  }\r\n\r\n  // method to register event listener and call back function when my video is connected\r\n  onMyPlayerVideoConnected(callback: (key: string) => void, context?: any) {\r\n    phaserEvents.on(Event.MY_PLAYER_VIDEO_CONNECTED, callback, context)\r\n  }\r\n\r\n  // method to register event listener and call back function when a player updated\r\n  onPlayerUpdated(\r\n    callback: (field: string, value: number | string, key: string) => void,\r\n    context?: any\r\n  ) {\r\n    phaserEvents.on(Event.PLAYER_UPDATED, callback, context)\r\n  }\r\n\r\n  // method to send player updates to Colyseus server\r\n  updatePlayer(currentX: number, currentY: number, currentAnim: string) {\r\n    this.room?.send(Message.UPDATE_PLAYER, { x: currentX, y: currentY, anim: currentAnim })\r\n  }\r\n\r\n  // method to send player name to Colyseus server\r\n  updatePlayerName(currentName: string) {\r\n    this.room?.send(Message.UPDATE_PLAYER_NAME, { name: currentName })\r\n  }\r\n\r\n  // method to send ready-to-connect signal to Colyseus server\r\n  readyToConnect() {\r\n    this.room?.send(Message.READY_TO_CONNECT)\r\n    phaserEvents.emit(Event.MY_PLAYER_READY)\r\n  }\r\n\r\n  // method to send ready-to-connect signal to Colyseus server\r\n  videoConnected() {\r\n    this.room?.send(Message.VIDEO_CONNECTED)\r\n    phaserEvents.emit(Event.MY_PLAYER_VIDEO_CONNECTED)\r\n  }\r\n\r\n  // method to send stream-disconnection signal to Colyseus server\r\n  playerStreamDisconnect(id: string) {\r\n    this.room?.send(Message.DISCONNECT_STREAM, { clientId: id })\r\n    this.webRTC?.deleteVideoStream(id)\r\n  }\r\n\r\n  connectToComputer(id: string) {\r\n    this.room?.send(Message.CONNECT_TO_COMPUTER, { computerId: id })\r\n  }\r\n\r\n  disconnectFromComputer(id: string) {\r\n    this.room?.send(Message.DISCONNECT_FROM_COMPUTER, { computerId: id })\r\n  }\r\n\r\n  onStopScreenShare(id: string) {\r\n    this.room?.send(Message.STOP_SCREEN_SHARE, { computerId: id })\r\n  }\r\n\r\n  onChatMessage(message: string) {\r\n    this.room?.send(Message.ADD_CHAT_MESSAGE, { content: message })\r\n  }\r\n\r\n  getRoom() {\r\n    return this.room\r\n  }\r\n}\r\n","import Phaser from 'phaser'\r\n\r\n// import { debugDraw } from '../utils/debug'\r\nimport { createCharacterAnims } from '../anims/CharacterAnims'\r\n\r\nimport Item from '../items/Item'\r\nimport '../characters/MyPlayer'\r\nimport '../characters/OtherPlayer'\r\nimport MyPlayer from '../characters/MyPlayer'\r\nimport PlayerSelector from '../characters/PlayerSelector'\r\nimport Network from '../services/Network'\r\nimport { IPlayer } from '../../../types/IOfficeState'\r\nimport OtherPlayer from '../characters/OtherPlayer'\r\nimport { PlayerBehavior } from '../../../types/PlayerBehavior'\r\n\r\nimport store from '../stores'\r\nimport { setConnected } from '../stores/UserStore'\r\n\r\nexport default class Game extends Phaser.Scene {\r\n  network!: Network\r\n  private cursors!: Phaser.Types.Input.Keyboard.CursorKeys\r\n  private keyE!: Phaser.Input.Keyboard.Key\r\n  private keyR!: Phaser.Input.Keyboard.Key\r\n  private map!: Phaser.Tilemaps.Tilemap\r\n  myPlayer!: MyPlayer\r\n  private items!: Phaser.Physics.Arcade.StaticGroup\r\n  private playerSelector!: Phaser.GameObjects.Zone\r\n  private otherPlayers!: Phaser.Physics.Arcade.Group\r\n  private otherPlayerMap = new Map<string, OtherPlayer>()\r\n  computerMap = new Map<string, Item>()\r\n\r\n  constructor() {\r\n    super('game')\r\n  }\r\n\r\n  registerKeys() {\r\n    this.cursors = this.input.keyboard.createCursorKeys()\r\n    // maybe we can have a dedicated method for adding keys if more keys are needed in the future\r\n    this.keyE = this.input.keyboard.addKey('E')\r\n    this.keyR = this.input.keyboard.addKey('R')\r\n  }\r\n\r\n  init() {\r\n    this.network = new Network()\r\n  }\r\n\r\n  async create() {\r\n    // initialize network instance (connect to server)\r\n    if (!this.network) {\r\n      throw new Error('server instance missing')\r\n    }\r\n    await this.network.join()\r\n    store.dispatch(setConnected(true))\r\n\r\n    // if in the future we have a bootstrap scene to manage all the scene transferring, we can put this line there\r\n    this.scene.stop('preloader')\r\n\r\n    createCharacterAnims(this.anims)\r\n\r\n    this.map = this.make.tilemap({ key: 'tilemap' })\r\n    const FloorAndGround = this.map.addTilesetImage('FloorAndGround', 'tiles_wall')\r\n\r\n    const groundLayer = this.map.createLayer('Ground', FloorAndGround)\r\n    groundLayer.setCollisionByProperty({ collides: true })\r\n\r\n    this.addGroupFromTiled('GenericObjectsOnCollide', 'generic', 'Generic', true)\r\n    this.addGroupFromTiled('GenericObjects', 'generic', 'Generic', false)\r\n\r\n    this.addGroupFromTiled('Wall', 'tiles_wall', 'FloorAndGround', false)\r\n    // debugDraw(groundLayer, this)\r\n\r\n    this.myPlayer = this.add.myPlayer(900, 930, 'adam', this.network.mySessionId)\r\n    this.playerSelector = new PlayerSelector(this, 0, 0, 16, 16)\r\n\r\n    // import item objects (currently chairs) from Tiled map to Phaser\r\n    this.items = this.physics.add.staticGroup({ classType: Item })\r\n    const chairLayer = this.map.getObjectLayer('Chair')\r\n    chairLayer.objects.forEach((chairObj) => {\r\n      const item = this.addObjectFromTiled(this.items, chairObj, 'chairs', 'chair') as Item\r\n      // custom properties[0] is the object direction specified in Tiled\r\n      item.itemDirection = chairObj.properties[0].value\r\n    })\r\n\r\n    const computerLayer = this.map.getObjectLayer('Computer')\r\n    var counter = 0\r\n    computerLayer.objects.forEach((Obj) => {\r\n      const item = this.addObjectFromTiled(this.items, Obj, 'computers', 'computer') as Item\r\n      item.setDepth(item.y + item.height * 0.6)\r\n      const id = String(counter)\r\n      item.id = id\r\n      item.scale = 0.7;\r\n      this.computerMap.set(id, item)\r\n      ++counter\r\n    })\r\n\r\n    const whiteboardLayer = this.map.getObjectLayer('Whiteboard')\r\n    whiteboardLayer.objects.forEach((Obj) => {\r\n      this.addObjectFromTiled(this.items, Obj, 'whiteboards', 'whiteboard') as Item\r\n    })\r\n\r\n    // import other objects from Tiled map to Phaser\r\n    this.addGroupFromTiled('Objects', 'office', 'Modern_Office_Black_Shadow', false)\r\n    this.addGroupFromTiled('ObjectsOnCollide', 'office', 'Modern_Office_Black_Shadow', true)\r\n\r\n    this.otherPlayers = this.physics.add.group({ classType: OtherPlayer })\r\n\r\n    this.cameras.main.zoom = 1.5\r\n    this.cameras.main.startFollow(this.myPlayer, true)\r\n\r\n    this.physics.add.collider([this.myPlayer, this.myPlayer.playerNameContainer], groundLayer)\r\n    this.physics.add.overlap(\r\n      this.playerSelector,\r\n      this.items,\r\n      this.handleItemSelectorOverlap,\r\n      undefined,\r\n      this\r\n    )\r\n\r\n    this.physics.add.overlap(\r\n      this.myPlayer,\r\n      this.otherPlayers,\r\n      this.handlePlayersOverlap,\r\n      undefined,\r\n      this\r\n    )\r\n\r\n    // register network event listeners\r\n    this.network.onPlayerJoined(this.handlePlayerJoined, this)\r\n    this.network.onPlayerLeft(this.handlePlayerLeft, this)\r\n    this.network.onMyPlayerReady(this.handleMyPlayerReady, this)\r\n    this.network.onMyPlayerVideoConnected(this.handleMyVideoConnected, this)\r\n    this.network.onPlayerUpdated(this.handlePlayerUpdated, this)\r\n    this.network.onItemUserAdded(this.handleItemUserAdded, this)\r\n    this.network.onItemUserRemoved(this.handleItemUserRemoved, this)\r\n  }\r\n\r\n  private handleItemSelectorOverlap(playerSelector, selectionItem) {\r\n    const currentItem = playerSelector.selectedItem\r\n    // currentItem is undefined if nothing was perviously selected\r\n    if (currentItem) {\r\n      // if the selection has not changed, do nothing\r\n      if (currentItem === selectionItem || currentItem.depth >= selectionItem.depth) {\r\n        return\r\n      }\r\n      // if selection changes, clear pervious dialog\r\n      if (this.myPlayer.playerBehavior !== PlayerBehavior.SITTING) currentItem.clearDialogBox()\r\n    }\r\n\r\n    // set selected item and set up new dialog\r\n    playerSelector.selectedItem = selectionItem\r\n    selectionItem.onOverlapDialog()\r\n  }\r\n\r\n  private addObjectFromTiled(\r\n    group: Phaser.Physics.Arcade.StaticGroup,\r\n    object: Phaser.Types.Tilemaps.TiledObject,\r\n    key: string,\r\n    tilesetName: string\r\n  ) {\r\n    const actualX = object.x! + object.width! * 0.5\r\n    const actualY = object.y! - object.height! * 0.5\r\n    const obj = group\r\n      .get(actualX, actualY, key, object.gid! - this.map.getTileset(tilesetName).firstgid)\r\n      .setDepth(actualY)\r\n    return obj\r\n  }\r\n\r\n  private addGroupFromTiled(\r\n    objectLayerName: string,\r\n    key: string,\r\n    tilesetName: string,\r\n    collidable: boolean\r\n  ) {\r\n    const group = this.physics.add.staticGroup()\r\n    const objectLayer = this.map.getObjectLayer(objectLayerName)\r\n    objectLayer.objects.forEach((object) => {\r\n      const actualX = object.x! + object.width! * 0.5\r\n      const actualY = object.y! - object.height! * 0.5\r\n      group\r\n        .get(actualX, actualY, key, object.gid! - this.map.getTileset(tilesetName).firstgid)\r\n        .setDepth(actualY)\r\n    })\r\n    if (this.myPlayer && collidable)\r\n      this.physics.add.collider([this.myPlayer, this.myPlayer.playerNameContainer], group)\r\n  }\r\n\r\n  // function to add new player to the otherPlayer group\r\n  private handlePlayerJoined(newPlayer: IPlayer, id: string) {\r\n    const otherPlayer = this.add.otherPlayer(newPlayer.x, newPlayer.y, 'adam', id, newPlayer.name)\r\n    this.otherPlayers.add(otherPlayer)\r\n    this.otherPlayerMap.set(id, otherPlayer)\r\n  }\r\n\r\n  // function to remove the player who left from the otherPlayer group\r\n  private handlePlayerLeft(id: string) {\r\n    if (this.otherPlayerMap.has(id)) {\r\n      const otherPlayer = this.otherPlayerMap.get(id)\r\n      if (!otherPlayer) return\r\n      this.otherPlayers.remove(otherPlayer, true, true)\r\n      this.otherPlayerMap.delete(id)\r\n    }\r\n  }\r\n\r\n  private handleMyPlayerReady() {\r\n    this.myPlayer.readyToConnect = true\r\n  }\r\n\r\n  private handleMyVideoConnected() {\r\n    this.myPlayer.videoConnected = true\r\n  }\r\n\r\n  // function to update target position upon receiving player updates\r\n  private handlePlayerUpdated(field: string, value: number | string, id: string) {\r\n    const otherPlayer = this.otherPlayerMap.get(id)\r\n    otherPlayer?.updateOtherPlayer(field, value)\r\n  }\r\n\r\n  private handlePlayersOverlap(myPlayer, otherPlayer) {\r\n    otherPlayer.makeCall(myPlayer, this.network?.webRTC)\r\n  }\r\n\r\n  private handleItemUserAdded(playerId: string, itemId: string) {\r\n    const computer = this.computerMap.get(itemId)\r\n    computer?.addCurrentUser(playerId)\r\n    computer?.updateStatus()\r\n  }\r\n\r\n  private handleItemUserRemoved(playerId: string, itemId: string) {\r\n    const computer = this.computerMap.get(itemId)\r\n    computer?.removeCurrentUser(playerId)\r\n    computer?.updateStatus()\r\n  }\r\n\r\n  update(t: number, dt: number) {\r\n    if (this.myPlayer && this.network) {\r\n      this.playerSelector.update(this.myPlayer, this.cursors)\r\n      this.myPlayer.update(this.playerSelector, this.cursors, this.keyE, this.keyR, this.network)\r\n    }\r\n  }\r\n}\r\n","import Phaser from 'phaser'\r\n\r\nexport default class Preloader extends Phaser.Scene {\r\n  private counter = 0\r\n\r\n  constructor() {\r\n    super('preloader')\r\n  }\r\n\r\n  preload() {\r\n    this.load.tilemapTiledJSON('tilemap', 'assets/map/map.json')\r\n\r\n    this.load.spritesheet('tiles_wall', 'assets/map/FloorAndGround.png', {\r\n      frameWidth: 32,\r\n      frameHeight: 32,\r\n    })\r\n\r\n    this.load.spritesheet('chairs', 'assets/items/chair.png', {\r\n      frameWidth: 32,\r\n      frameHeight: 64,\r\n    })\r\n\r\n    this.load.spritesheet('computers', 'assets/items/computer.png', {\r\n      frameWidth: 96,\r\n      frameHeight: 64,\r\n    })\r\n\r\n    this.load.spritesheet('whiteboards', 'assets/items/whiteboard.png', {\r\n      frameWidth: 64,\r\n      frameHeight: 64,\r\n    })\r\n\r\n    this.load.spritesheet('office', 'assets/items/Modern_Office_Black_Shadow.png', {\r\n      frameWidth: 32,\r\n      frameHeight: 32,\r\n    })\r\n\r\n    this.load.spritesheet('generic', 'assets/items/Generic.png', {\r\n      frameWidth: 32,\r\n      frameHeight: 32,\r\n    })\r\n\r\n    this.load.spritesheet('adam', 'assets/character/adam.png', {\r\n      frameWidth: 32,\r\n      frameHeight: 48,\r\n    })\r\n\r\n    this.load.spritesheet('ash', 'assets/character/ash.png', {\r\n      frameWidth: 32,\r\n      frameHeight: 48,\r\n    })\r\n\r\n    this.load.spritesheet('lucy', 'assets/character/lucy.png', {\r\n      frameWidth: 32,\r\n      frameHeight: 48,\r\n    })\r\n\r\n    this.load.spritesheet('nancy', 'assets/character/nancy.png', {\r\n      frameWidth: 32,\r\n      frameHeight: 48,\r\n    })\r\n  }\r\n\r\n  create() {\r\n    // create loading texts\r\n    const screenCenterX = this.cameras.main.worldView.x + this.cameras.main.width / 2\r\n    const screenCenterY = this.cameras.main.worldView.y + this.cameras.main.height\r\n    const loadingText = this.add\r\n      .text(screenCenterX, screenCenterY - 100, 'Loading...')\r\n      .setOrigin(0.5)\r\n      .setFontSize(30)\r\n      .setColor('#000000')\r\n\r\n    this.time.addEvent({\r\n      delay: 750,\r\n      callback: () => {\r\n        switch (this.counter % 3) {\r\n          case 0:\r\n            loadingText.setText('loading.')\r\n            break\r\n\r\n          case 1:\r\n            loadingText.setText('loading..')\r\n            break\r\n\r\n          case 2:\r\n            loadingText.setText('loading...')\r\n            break\r\n        }\r\n        this.counter += 1\r\n      },\r\n      loop: true,\r\n    })\r\n\r\n    this.scene.run('game')\r\n  }\r\n}\r\n","import Phaser from 'phaser'\r\nimport Game from './scenes/Game'\r\nimport Preloader from './scenes/Preloader'\r\n\r\nconst config: Phaser.Types.Core.GameConfig = {\r\n  type: Phaser.AUTO,\r\n  parent: 'phaser-container',\r\n  backgroundColor: '#CFF5FC',\r\n  pixelArt: true, // Prevent pixel art from becoming blurred when scaled.\r\n  scale: {\r\n    mode: Phaser.Scale.ScaleModes.RESIZE,\r\n    width: window.innerWidth,\r\n    height: window.innerHeight,\r\n    // min: {\r\n    //   width: 800,\r\n    //   height: 600,\r\n    // },\r\n  },\r\n  physics: {\r\n    default: 'arcade',\r\n    arcade: {\r\n      gravity: { y: 0 },\r\n      debug: false,\r\n    },\r\n  },\r\n  autoFocus: true,\r\n  scene: [Preloader, Game],\r\n}\r\n\r\nconst phaserGame = new Phaser.Game(config)\r\n\r\n;(window as any).game = phaserGame\r\n\r\nexport default phaserGame\r\n","import { createTheme } from '@mui/material/styles'\r\n\r\nconst muiTheme = createTheme({\r\n  palette: {\r\n    mode: 'dark',\r\n    primary: {\r\n      main: '#426dea',\r\n    },\r\n    secondary: {\r\n      main: '#42eacb',\r\n    },\r\n  },\r\n})\r\n\r\nexport default muiTheme\r\n","import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux'\r\nimport type { RootState, AppDispatch } from './stores'\r\n\r\n// Use throughout your app instead of plain `useDispatch` and `useSelector`\r\nexport const useAppDispatch = () => useDispatch<AppDispatch>()\r\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector\r\n","import React, { useState } from 'react'\r\nimport styled from 'styled-components'\r\nimport TextField from '@mui/material/TextField'\r\nimport Button from '@mui/material/Button'\r\nimport Alert from '@mui/material/Alert'\r\nimport AlertTitle from '@mui/material/AlertTitle'\r\n\r\nimport { Swiper, SwiperSlide } from 'swiper/react'\r\nimport SwiperCore, { Navigation } from 'swiper'\r\nimport 'swiper/swiper.min.css'\r\nimport 'swiper/components/navigation/navigation.min.css'\r\n\r\nimport Adam from '../assets/Adam_login.png'\r\nimport Ash from '../assets/Ash_login.png'\r\nimport Lucy from '../assets/Lucy_login.png'\r\nimport Nancy from '../assets/Nancy_login.png'\r\nimport { useAppSelector, useAppDispatch } from '../hooks'\r\nimport { setLoggedIn } from '../stores/UserStore'\r\n\r\nimport phaserGame from '../PhaserGame'\r\nimport Game from '../scenes/Game'\r\n\r\nSwiperCore.use([Navigation])\r\n\r\nconst Wrapper = styled.div`\r\n  position: fixed;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  background: #222639;\r\n  border-radius: 16px;\r\n  padding: 36px 60px;\r\n`\r\n\r\nconst Title = styled.h1`\r\n  font-size: 24px;\r\n  color: #eee;\r\n  text-align: center;\r\n`\r\n\r\nconst SubTitle = styled.h3`\r\n  width: 160px;\r\n  font-size: 16px;\r\n  color: #eee;\r\n  text-align: center;\r\n`\r\n\r\nconst Content = styled.div`\r\n  display: flex;\r\n  margin: 36px 0;\r\n`\r\n\r\nconst Left = styled.div`\r\n  margin-right: 48px;\r\n\r\n  --swiper-navigation-size: 24px;\r\n\r\n  .swiper-container {\r\n    width: 160px;\r\n    height: 220px;\r\n    border-radius: 8px;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .swiper-slide {\r\n    width: 160px;\r\n    height: 220px;\r\n    background: #dbdbe0;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  .swiper-slide img {\r\n    display: block;\r\n    width: 95px;\r\n    height: 136px;\r\n    object-fit: contain;\r\n  }\r\n`\r\n\r\nconst Right = styled.div`\r\n  width: 300px;\r\n`\r\n\r\nconst Bottom = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n`\r\n\r\nconst Warning = styled.div`\r\n  margin-top: 30px;\r\n  position: relative;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 3px;\r\n`\r\n\r\nconst avatars = [\r\n  { name: 'adam', img: Adam },\r\n  { name: 'ash', img: Ash },\r\n  { name: 'lucy', img: Lucy },\r\n  { name: 'nancy', img: Nancy },\r\n]\r\n\r\nexport default function LoginDialog() {\r\n  const [name, setName] = useState<string>('')\r\n  const [avatarIndex, setAvatarIndex] = useState<number>(0)\r\n  const [nameFieldEmpty, setNameFieldEmpty] = useState<boolean>(false)\r\n  const dispatch = useAppDispatch()\r\n  const connected = useAppSelector((state) => state.user.connected)\r\n  const videoConnected = useAppSelector((state) => state.user.videoConnected)\r\n\r\n  return (\r\n    <Wrapper>\r\n      <Title>Welcome to TSC Verse</Title>\r\n      <Content>\r\n        <Left>\r\n          <SubTitle>Select an avatar</SubTitle>\r\n          <Swiper\r\n            // install Swiper modules\r\n            navigation\r\n            spaceBetween={0}\r\n            slidesPerView={1}\r\n            onSlideChange={(swiper) => {\r\n              setAvatarIndex(swiper.activeIndex)\r\n              const game = phaserGame.scene.keys.game as Game\r\n              game.myPlayer?.setPlayerTexture(avatars[avatarIndex].name)\r\n            }}\r\n          >\r\n            {avatars.map((avatar) => (\r\n              <SwiperSlide key={avatar.name}>\r\n                <img src={avatar.img} alt={avatar.name} />\r\n              </SwiperSlide>\r\n            ))}\r\n          </Swiper>\r\n        </Left>\r\n        <Right>\r\n          <TextField\r\n            autoFocus\r\n            fullWidth\r\n            label=\"Name\"\r\n            variant=\"outlined\"\r\n            color=\"secondary\"\r\n            error={nameFieldEmpty}\r\n            helperText={nameFieldEmpty && 'Name is required'}\r\n            onInput={(e) => {\r\n              setName((e.target as HTMLInputElement).value)\r\n              if (connected) {\r\n                const game = phaserGame.scene.keys.game as Game\r\n                game.myPlayer.setPlayerName(name)\r\n              }\r\n            }}\r\n          />\r\n          {!videoConnected && (\r\n            <Warning>\r\n              <Alert severity=\"warning\">\r\n                <AlertTitle>Warning</AlertTitle>\r\n                No webcam/mic connected - <strong>connect one for best experience!</strong>\r\n              </Alert>\r\n              <Button\r\n                variant=\"outlined\"\r\n                color=\"secondary\"\r\n                onClick={() => {\r\n                  const game = phaserGame.scene.keys.game as Game\r\n                  game.network.webRTC?.getUserMedia()\r\n                }}\r\n              >\r\n                Connect Webcam\r\n              </Button>\r\n            </Warning>\r\n          )}\r\n\r\n          {videoConnected && (\r\n            <Warning>\r\n              <Alert>Webcam connected!</Alert>\r\n            </Warning>\r\n          )}\r\n        </Right>\r\n      </Content>\r\n      <Bottom>\r\n        <Button\r\n          variant=\"contained\"\r\n          color=\"secondary\"\r\n          size=\"large\"\r\n          onClick={() => {\r\n            if (name === '') {\r\n              setNameFieldEmpty(true)\r\n            } else {\r\n              if (connected) {\r\n                console.log('Join! Name:', name, 'Avatar:', avatars[avatarIndex].name)\r\n                const game = phaserGame.scene.keys.game as Game\r\n                game.registerKeys()\r\n                game.myPlayer.setPlayerName(name)\r\n                game.myPlayer.setPlayerTexture(avatars[avatarIndex].name)\r\n                game.network.readyToConnect()\r\n                dispatch(setLoggedIn(true))\r\n              }\r\n            }\r\n          }}\r\n        >\r\n          Join\r\n        </Button>\r\n      </Bottom>\r\n    </Wrapper>\r\n  )\r\n}\r\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAABICAMAAACHrYYZAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAclBMVEUAAABWWXJrb2lIS1RAQFc6OlBcYWdcX1dGRl5gY1xISVNISVhFRlBCQll0Z3JRSWZUTGpuXGR0YmuDbG88PFJHR19RRmRWWXJGRl46OlCVnVhoclNfaUpdYEO7o4b/y7D2rp/2l4SAXo6fdKj/uJP///9thjlLAAAAF3RSTlMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAL2TUGAAAAABYktHRCXDAckPAAAAB3RJTUUH5QoFBSgkkKZAkgAAAAFvck5UAc+id5oAAAFaSURBVEjHzZbHcoNAEERFzhljYZMM/P83ukUDhUxpb4zcB7Q704/SpmFvt/8nTdN0Xf9cdH9WXdeGYZimaVmWJGDbNqxfJ30vIuY4juu6YgDcSLwCmqZBG5jneStzPYAOc2c3AaZgw/wKAwoBw+T6vv8YxvUA95zCymfbtuswrgeCIKgXIdRsOmPIwhOGoQBAK93IdV1HU7dpB8gIA0j3fU93vwntdwG9UsIAdtUwDGoABhY1AQBbHK09gdDRd+zCFkWRAIBCEMfxPgws6hFglwOA7VE1rgfwwUuShMDPouGgPQJDmqZiAOZuHMe7UjTIAFmWAZimaVQKBgB5ngsA+JnnmYxCtOEpBmA5eVbP/54nEwYxoCgKhljRzmvM+sXXwSwAYD+hcJRlidCrrzVSMMC2numLAYqngun9iszrIIGny7EgwKVF42PRMfIWoKoqriga1qI/ESngF89yOEmzGHKGAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIxLTEwLTA1VDA1OjM5OjUxKzAwOjAwksUfagAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMS0xMC0wNVQwNTozOTo1MSswMDowMOOYp9YAAAAASUVORK5CYII=\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAABICAMAAACHrYYZAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAdVBMVEUAAABWWXJ3amtgVVlGRl5dVFlOT2hdVl9XTVtAQFc+PlQ6OlBSR1JuXGSDbG88PFJHR19EPU5WWXJGRl66jV6Vc1CNcFGKZVI6OlD2rp//y7BaRErhm5uiOUtvSU2Li6v/uJOuSlKdo7f2l4R4fZOAkaX////gL/b+AAAAEnRSTlMAAAAAAAAAAAAAAAAAAAAAAACVcz0/AAAAAWJLR0QmWgiYtQAAAAd0SU1FB+UKBgI7LZ9vAM8AAAABb3JOVAHPoneaAAABUElEQVRIx+2W21aDMBBF20KBQilWLVdLQfT/f9FtpsZYZOkLgw+eB5g5nL1WSAiwWv3r11qv15vN5t7oYSTP83zf1wRs+nGkkxHMdrv9ZOYHgiD4Nm2ZPM9h1ABOYRjS/whEUfTOzA/sdjsamb6paQUoioIYYQUgjuOyLE/Tyj9EjLACkCQJFf04cSNihNUAZs29VlVVXdd/BKiMaiNZYPEpFgHctAC0ywKEqGtH8hAsBcjom6ZxAVq5E2Vgv9/zRsB9MqocWYcAMTWAwTFW9ys4/joS+HLTcwJpmgpwPp/btuVIezGyfmNES1gBYHxd19GQ7vueI/WzEYU4HKmJEVYDhmGwjAtYh4AacDgcOJVGsqgUstKuIzVhBYC/Ab6+WZZhvUyISwSIXf81ZgZEsitejexOoBDnuhNcaQH2ub8zcp1FgOPxKCtKkRjdOFrAG746+Pu4z9Q0AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIxLTEwLTA2VDAyOjU5OjI0KzAwOjAwdjZBPQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMS0xMC0wNlQwMjo1OToyNCswMDowMAdr+YEAAAAASUVORK5CYII=\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAABICAMAAACHrYYZAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAclBMVEUAAABWWXJ6aGVnUVBGRl51ZGFOT2hjU1lfTlRAQFdCQllcS1ByXmODcnk8PFI6OlBHR19pVVNWWXJGRl7CiEvMllmzez+rZzavcjs6OlD/oKD2rp//y7A7eqJ3STTgcHC/ppDQvpxaZ3VqhJPHjFn///+qkMhRAAAAEnRSTlMAAAAAAAAAAAAAAAAAAAAAAACVcz0/AAAAAWJLR0QlwwHJDwAAAAd0SU1FB+UKBgMZFREdlEYAAAABb3JOVAHPoneaAAABUklEQVRIx+2W2VKDQBBFw74lIIoBwiKg//+NXudq1whK+ULnxfvCdM85KZgJxZxO//lzHMdxXffR5GkTz/N839cUQAdBALSqqmcrV5O6rtfO8UIYhqAxZ9OQKWBAR03AJYoi1Jxb0fwVCnEcfzjHC0mSoECraZrrT+Ez0AGsIKRp2rZt/ZWtJlPAACsIWZbxGbZpTOxnAKwg7NDc8tvtJk3ACoK9psLJ/6/rur7v0ZSV1RTkpskRZTBWFmwUpY2ivIvAgvc9DENvhaWyMI4j1xTdF5POinS42YB1BNzZNE32V3D7dQQATEc4n8+o53medgMAGGAFARfsJZ2dCKYmYC+xaly+VdCUl0RHuFwubCHLsmxPV2hyFmPACgJOA/j65nmO1usvwRQAYJ9njYMFpigKEeRNwEAEAN/OrVrCmwkGDyZ25y5CWZbcUQwKk1VHS3gHKAAJ6thLGQcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMTAtMDZUMDM6MjU6MTUrMDA6MDCwX2HiAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTEwLTA2VDAzOjI1OjE1KzAwOjAwwQLZXgAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAABICAMAAACHrYYZAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAclBMVEUAAABWWXJlWWVUR1RGRl5kV2ROT2hVS1tRR1ZAQFdCQllORFNsXGNxYWiDcnk8PFI6OlBHR19KS2FWWXJGRl6DW0yGYVCAVElySkB7UUc6OlDyuJn/oKD/y7D2rp9kSULgcHBsboXY0OAqpeIzg9b////m8SWDAAAAE3RSTlMAAAAAAAAAAAAAAAAAAAAAAAAAZPGxjQAAAAFiS0dEJcMByQ8AAAAHdElNRQflCgUFKSsZAmxCAAAAAW9yTlQBz6J3mgAAAWNJREFUSMftlllThDAQhJdruQ9RXE5Z0P//G23T61QW1ipfGF/sB8LM9Eclk6qE0+lfv5bjOK7rPhu97OR5nu/7mgDcQRDA2jTNq6WLUdu2W+Z44Hw+w42a7QZMAC9k1AAMYRgiZm3j5lcIRFH0xRwPxHGMAKmu6y6PxDWQgVkBSJKk73umHjJIsgobzApAmqZcAwG7oZ2RvQaYFQBxQ8MwdJa45eM4igFmBUB6Ck3T9HavyUgMMGsCmPT0g+zN1gSwtaghtK0MeZzpA+wjmyuSXmsC8zxzAchejeydlgyXAbMOgJlt7sL97chQB8iyDMCyLEiRXNf13QgvkoQBQJ7nCgAG7CVqTPH5YSQhnjDAdjtmVADs5b650lCUeILoAEVRYOiNlm/RJyGrSMKsAOBvALdvWZZcA2cskgwMsN3+NQ4GqKqqbJPdUAqGu/9WLUCa+GRkZ/4EqOua08VLZbTJaAGfHgYMIaGaP2wAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMTAtMDVUMDU6NDE6MzIrMDA6MDBfrlkHAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTEwLTA1VDA1OjQxOjMyKzAwOjAwLvPhuwAAAABJRU5ErkJggg==\"","import { VideoHTMLAttributes, useEffect, useRef } from 'react'\r\n\r\ntype PropsType = VideoHTMLAttributes<HTMLVideoElement> & {\r\n  srcObject: MediaStream\r\n}\r\n\r\nexport default function Video({ srcObject, ...props }: PropsType) {\r\n  const refVideo = useRef<HTMLVideoElement>(null)\r\n\r\n  useEffect(() => {\r\n    if (!refVideo.current) return\r\n    refVideo.current.srcObject = srcObject\r\n  }, [srcObject])\r\n\r\n  return <video ref={refVideo} {...props} />\r\n}\r\n","import React from 'react'\r\nimport styled from 'styled-components'\r\nimport Button from '@mui/material/Button'\r\nimport IconButton from '@mui/material/IconButton'\r\nimport CloseIcon from '@mui/icons-material/Close'\r\n\r\nimport { useAppSelector, useAppDispatch } from '../hooks'\r\nimport { closeComputerDialog } from '../stores/ComputerStore'\r\n\r\nimport Video from './Video'\r\n\r\nconst Backdrop = styled.div`\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  overflow: hidden;\r\n  padding: 16px 180px 16px 16px;\r\n`\r\nconst Wrapper = styled.div`\r\n  width: 100%;\r\n  height: 100%;\r\n  background: #222639;\r\n  border-radius: 16px;\r\n  padding: 16px;\r\n  color: #eee;\r\n  position: relative;\r\n  display: flex;\r\n  flex-direction: column;\r\n\r\n  .close {\r\n    position: absolute;\r\n    top: 16px;\r\n    right: 16px;\r\n  }\r\n`\r\n\r\nconst VideoGrid = styled.div`\r\n  flex: 1;\r\n  min-height: 0;\r\n  display: grid;\r\n  grid-gap: 10px;\r\n  grid-template-columns: repeat(auto-fit, minmax(40%, 1fr));\r\n\r\n  .video-container {\r\n    position: relative;\r\n    background: black;\r\n    border-radius: 8px;\r\n    overflow: hidden;\r\n\r\n    video {\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      width: 100%;\r\n      height: 100%;\r\n      min-width: 0;\r\n      min-height: 0;\r\n      object-fit: contain;\r\n    }\r\n\r\n    .player-name {\r\n      position: absolute;\r\n      bottom: 16px;\r\n      left: 16px;\r\n      color: #fff;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      text-shadow: 0 1px 2px rgb(0 0 0 / 60%), 0 0 2px rgb(0 0 0 / 30%);\r\n      white-space: nowrap;\r\n    }\r\n  }\r\n`\r\n\r\nfunction VideoContainer({ playerName, stream }) {\r\n  return (\r\n    <div className=\"video-container\">\r\n      <Video srcObject={stream} autoPlay></Video>\r\n      {playerName && <div className=\"player-name\">{playerName}</div>}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default function ComputerDialog() {\r\n  const dispatch = useAppDispatch()\r\n  const playerNameMap = useAppSelector((state) => state.user.playerNameMap)\r\n  const shareScreenManager = useAppSelector((state) => state.computer.shareScreenManager)\r\n  const myStream = useAppSelector((state) => state.computer.myStream)\r\n  const peerStreams = useAppSelector((state) => state.computer.peerStreams)\r\n\r\n  return (\r\n    <Backdrop>\r\n      <Wrapper>\r\n        <IconButton\r\n          aria-label=\"close dialog\"\r\n          className=\"close\"\r\n          onClick={() => dispatch(closeComputerDialog())}\r\n        >\r\n          <CloseIcon />\r\n        </IconButton>\r\n\r\n        <div className=\"toolbar\">\r\n          <Button\r\n            variant=\"contained\"\r\n            color=\"secondary\"\r\n            onClick={() => {\r\n              if (shareScreenManager?.myStream) {\r\n                shareScreenManager?.stopScreenShare()\r\n              } else {\r\n                shareScreenManager?.startScreenShare()\r\n              }\r\n            }}\r\n          >\r\n            {shareScreenManager?.myStream ? 'Stop sharing' : 'Share Screen'}\r\n          </Button>\r\n        </div>\r\n\r\n        <VideoGrid>\r\n          {myStream && <VideoContainer stream={myStream} playerName=\"You\" />}\r\n\r\n          {[...peerStreams.entries()].map(([id, { stream }]) => {\r\n            const playerName = playerNameMap.get(id)\r\n            return <VideoContainer key={id} playerName={playerName} stream={stream} />\r\n          })}\r\n        </VideoGrid>\r\n      </Wrapper>\r\n    </Backdrop>\r\n  )\r\n}\r\n","import React, { useState } from 'react'\r\nimport styled from 'styled-components'\r\nimport Button from '@mui/material/Button'\r\nimport Alert from '@mui/material/Alert'\r\nimport AlertTitle from '@mui/material/AlertTitle'\r\n\r\nimport phaserGame from '../PhaserGame'\r\nimport Game from '../scenes/Game'\r\n\r\nconst Backdrop = styled.div`\r\n  position: fixed;\r\n  top: 0;\r\n`\r\n\r\nconst Wrapper = styled.div`\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 16px;\r\n  position: relative;\r\n  display: flex;\r\n  flex-direction: column;\r\n`\r\n\r\nexport default function VideoConnectionDialog() {\r\n  const [connectionWarning, setConnectionWarning] = useState(true)\r\n  return (\r\n    <Backdrop>\r\n      <Wrapper>\r\n        {connectionWarning && (\r\n          <Alert\r\n            severity=\"warning\"\r\n            onClose={() => {\r\n              setConnectionWarning(!connectionWarning)\r\n            }}\r\n          >\r\n            <AlertTitle>Warning</AlertTitle>\r\n            No webcam connected\r\n            <br /> <strong>connect one for full experience!</strong>\r\n          </Alert>\r\n        )}\r\n        <Button\r\n          variant=\"contained\"\r\n          color=\"secondary\"\r\n          onClick={() => {\r\n            const game = phaserGame.scene.keys.game as Game\r\n            game.network.webRTC?.getUserMedia()\r\n          }}\r\n        >\r\n          Connect Webcam\r\n        </Button>\r\n      </Wrapper>\r\n    </Backdrop>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport styled from 'styled-components'\r\nimport IconButton from '@mui/material/IconButton'\r\nimport CloseIcon from '@mui/icons-material/Close'\r\n\r\nimport { useAppDispatch } from '../hooks'\r\nimport { closeWhiteboardDialog } from '../stores/WhiteboardStore'\r\n\r\nconst Backdrop = styled.div`\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  overflow: hidden;\r\n  padding: 16px 180px 16px 16px;\r\n`\r\nconst Wrapper = styled.div`\r\n  width: 100%;\r\n  height: 100%;\r\n  background: #222639;\r\n  border-radius: 16px;\r\n  padding: 16px;\r\n  color: #eee;\r\n  position: relative;\r\n  display: flex;\r\n  flex-direction: column;\r\n\r\n  .close {\r\n    position: absolute;\r\n    top: 16px;\r\n    right: 16px;\r\n  }\r\n`\r\n\r\nconst WhiteboardWrapper = styled.div`\r\n  flex: 1;\r\n  border-radius: 25px;\r\n  overflow: hidden;\r\n  margin-right: 50px;\r\n  iframe {\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n`\r\n\r\nexport default function WhiteboardDialog() {\r\n  const dispatch = useAppDispatch()\r\n\r\n  return (\r\n    <Backdrop>\r\n      <Wrapper>\r\n        <IconButton\r\n          aria-label=\"close dialog\"\r\n          className=\"close\"\r\n          onClick={() => dispatch(closeWhiteboardDialog())}\r\n        >\r\n          <CloseIcon />\r\n        </IconButton>\r\n\r\n        <WhiteboardWrapper>\r\n          <iframe title=\"white board\" src=\"https://app.tryeraser.com/\" />\r\n        </WhiteboardWrapper>\r\n      </Wrapper>\r\n    </Backdrop>\r\n  )\r\n}\r\n","import React, { useRef } from 'react'\r\nimport styled from 'styled-components'\r\nimport Box from '@mui/material/Box'\r\nimport Fab from '@mui/material/Fab'\r\nimport List from '@mui/material/List'\r\nimport Divider from '@mui/material/Divider'\r\nimport IconButton from '@mui/material/IconButton'\r\nimport InputBase from '@mui/material/InputBase'\r\nimport InsertEmoticonIcon from '@mui/icons-material/InsertEmoticon'\r\nimport ChatBubbleOutlineIcon from '@mui/icons-material/ChatBubbleOutline'\r\nimport CloseIcon from '@mui/icons-material/Close'\r\nimport 'emoji-mart/css/emoji-mart.css'\r\nimport { Picker } from 'emoji-mart'\r\nimport Game from '../scenes/Game'\r\nimport phaserGame from '../PhaserGame'\r\nimport { useAppSelector } from '../hooks'\r\n\r\nconst Backdrop = styled.div`\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  height: 420px;\r\n  width: 560px;\r\n  max-height: 50%;\r\n  max-width: 50%;\r\n`\r\n\r\nconst Wrapper = styled.div`\r\n  height: 100%;\r\n  padding: 16px;\r\n  position: relative;\r\n  display: flex;\r\n  flex-direction: column;\r\n`\r\n\r\nconst FabWrapper = styled.div`\r\n  margin-top: auto;\r\n`\r\n\r\nconst ChatHeader = styled.div`\r\n  height: 35px;\r\n  background: #000000a7;\r\n  /* background: linear-gradient(0deg, #000000a7, #2424249e); */\r\n  border-radius: 10px 10px 0px 0px;\r\n\r\n  h3 {\r\n    color: #fff;\r\n    margin: 7px;\r\n    font-size: 17px;\r\n    text-align: center;\r\n  }\r\n\r\n  .close {\r\n    position: absolute;\r\n    top: 15px;\r\n    right: 15px;\r\n  }\r\n`\r\n\r\nconst ChatBox = styled(Box)`\r\n  height: 100%;\r\n  width: 100%;\r\n  overflow: auto;\r\n  background: #000000a7;\r\n  background: #2c2c2c;\r\n  border: 1px solid #00000029;\r\n  /* border: 1px solid #5e696b; */\r\n`\r\n\r\nconst InputWrapper = styled.div`\r\n  box-shadow: 10px 10px 10px #00000018;\r\n  border: 1px solid #42eacb;\r\n  border-radius: 0px 0px 10px 10px;\r\n  display: flex;\r\n  flex-direction: row;\r\n  background: linear-gradient(180deg, #000000c1, #242424c0);\r\n`\r\n\r\nconst InputTextField = styled(InputBase)`\r\n  border-radius: 0px 0px 10px 10px;\r\n  input {\r\n    padding: 5px;\r\n    font-size: 15;\r\n  }\r\n`\r\n\r\nconst colorArr = ['#7bf1a8', '#ff7e50', '#9acd32', '#daa520', '#ff69b4', '#c085f6']\r\n\r\nconst o = new Intl.DateTimeFormat('en', {\r\n  timeStyle: 'short',\r\n  dateStyle: 'short',\r\n})\r\n\r\nexport default function Chat() {\r\n  const messages = useAppSelector((state) => state.chat.messages)\r\n  const [value, setValue] = React.useState('')\r\n  const [showChat, setShowChat] = React.useState(true)\r\n  const [showEmojiPicker, setShowEmojiPicker] = React.useState(false)\r\n  const ref = useRef<HTMLDivElement>(null)\r\n  const messageRef = useRef('');\r\n\r\n\r\n  const onChat = event => {\r\n    setValue(event.target.value)\r\n    messageRef.current = event.target.value\r\n  }\r\n\r\n  const game = phaserGame.scene.keys.game as Game\r\n  const _handleEnterKey = event => {\r\n    if(event.keyCode === 13) { //Enter key\r\n      game.network.onChatMessage(messageRef.current)\r\n      messageRef.current = ''\r\n      setValue('')\r\n    }\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    const chatRef = (ref.current as HTMLDivElement)\r\n\r\n    const scrollHeight = chatRef?.scrollHeight || 0;\r\n    const height = chatRef?.clientHeight || 0;\r\n    const maxScrollTop = scrollHeight - height;\r\n    chatRef.scrollTop = maxScrollTop > 0 ? maxScrollTop : 0;\r\n  }, [messages])\r\n\r\n  React.useEffect(() => {\r\n    document.addEventListener(\"keydown\", _handleEnterKey, false);\r\n\r\n    return (() => {\r\n      document.removeEventListener(\"keydown\", _handleEnterKey, false);\r\n    })\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [])\r\n  return (\r\n    <>\r\n      <Backdrop>\r\n        <Wrapper>\r\n          {showChat ? (\r\n            <>\r\n              <ChatHeader>\r\n                <h3>Chat</h3>\r\n                <IconButton\r\n                  aria-label=\"close dialog\"\r\n                  className=\"close\"\r\n                  onClick={() => setShowChat(!showChat)}\r\n                  size=\"small\"\r\n                >\r\n                  <CloseIcon />\r\n                </IconButton>\r\n              </ChatHeader>\r\n              <ChatBox ref={ref}>\r\n                <List>\r\n                  {messages.map(({ content, name }, index) => (\r\n                    <React.Fragment key={index}>\r\n                      <Divider\r\n                        style={{\r\n                          color: '#d1cfcf',\r\n                          margin: '7px',\r\n                          textShadow: '0.3px 0.3px black',\r\n                          fontSize: 14,\r\n                        }}\r\n                      >\r\n                        {o.format(Date.now())}\r\n                      </Divider>\r\n                      <p\r\n                        style={{\r\n                          // color: '#7bffe7',\r\n                          color: colorArr[Math.floor(Math.random() * colorArr.length)],\r\n                          margin: '7px',\r\n                          textShadow: '0.3px 0.3px black',\r\n                          fontSize: 15,\r\n                          fontWeight: 'bold',\r\n                          lineHeight: 1.4,\r\n                        }}\r\n                      >\r\n                        {`${name} `}\r\n                        <span style={{ color: 'white', fontWeight: 'normal' }}>{content}</span>{' '}\r\n                      </p>\r\n                      {/* <ListItem key={index + person}>\r\n                    <ListItemText primary={value} secondary={secondary} />\r\n                  </ListItem> */}\r\n                    </React.Fragment>\r\n                  ))}\r\n\r\n                  {/* <p\r\n                    style={{\r\n                      color: '#ffe346',\r\n                      fontWeight: 'bold',\r\n                      margin: '7px',\r\n                      lineHeight: 1.3,\r\n                      fontSize: 15,\r\n                    }}\r\n                  >\r\n                    Dax Joined the room!\r\n                  </p> */}\r\n                </List>\r\n                {showEmojiPicker && (\r\n                  <Picker\r\n                    theme=\"dark\"\r\n                    showSkinTones={false}\r\n                    showPreview={false}\r\n                    style={{ position: 'absolute', bottom: '58px', right: '16px' }}\r\n                    onSelect={(emoji) => {\r\n                      setValue('hihi ' + emoji.native)\r\n                      setShowEmojiPicker(!showEmojiPicker)\r\n                    }}\r\n                    exclude={['recent', 'flags']}\r\n                  />\r\n                )}\r\n              </ChatBox>\r\n              <InputWrapper>\r\n                <InputTextField autoFocus fullWidth placeholder=\"Aa\" value={value} onChange={onChat}/>\r\n                {/* <IconButton aria-label=\"emoji\">\r\n                  <InsertEmoticonIcon\r\n                    onClick={() => {\r\n                      setShowEmojiPicker(!showEmojiPicker)\r\n                    }}\r\n                  />\r\n                </IconButton> */}\r\n              </InputWrapper>\r\n            </>\r\n          ) : (\r\n            <FabWrapper>\r\n              <Fab\r\n                color=\"secondary\"\r\n                aria-label=\"showChat\"\r\n                onClick={() => {\r\n                  setShowChat(!showChat)\r\n                }}\r\n              >\r\n                <ChatBubbleOutlineIcon />\r\n              </Fab>\r\n            </FabWrapper>\r\n          )}\r\n        </Wrapper>\r\n      </Backdrop>\r\n    </>\r\n  )\r\n}\r\n","import React from 'react'\r\n\r\nimport { useAppSelector } from './hooks'\r\n\r\nimport LoginDialog from './components/LoginDialog'\r\nimport ComputerDialog from './components/ComputerDialog'\r\nimport VideoConnectionDialog from './components/VideoConnectionDialog'\r\nimport WhiteboardDialog from './components/WhiteboardDialog'\r\nimport Chat from './components/Chat'\r\n// import Debug from './components/Debug'\r\n\r\nfunction App() {\r\n  const loggedIn = useAppSelector((state) => state.user.loggedIn)\r\n  const computerDialogOpen = useAppSelector((state) => state.computer.computerDialogOpen)\r\n  const videoConnected = useAppSelector((state) => state.user.videoConnected)\r\n  const whiteboardDialogOpen = useAppSelector((state) => state.whiteboard.whiteboardDialogOpen)\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      {/* <Debug /> */}\r\n\r\n      {/* Render the LoginDialog if not logged in, else render Chat. */}\r\n      {loggedIn ? <Chat /> : <LoginDialog />}\r\n\r\n      {/* Render the ComputerDialog if user is using a computer. */}\r\n      {computerDialogOpen && <ComputerDialog />}\r\n\r\n      {/* Render the VideoConnectionDialog if user is not connected to a webcam. */}\r\n      {!computerDialogOpen && !videoConnected && loggedIn && <VideoConnectionDialog />}\r\n      {/* Render the WhiteboardDialog if user is using a whiteboard. */}\r\n      {whiteboardDialogOpen && <WhiteboardDialog />}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default App\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import 'regenerator-runtime/runtime'\r\nimport React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport { Provider } from 'react-redux'\r\nimport { ThemeProvider } from '@mui/material/styles'\r\n\r\nimport './index.scss'\r\nimport './PhaserGame'\r\nimport muiTheme from './MuiTheme'\r\nimport App from './App'\r\nimport reportWebVitals from './reportWebVitals'\r\nimport store from './stores'\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <Provider store={store}>\r\n      <ThemeProvider theme={muiTheme}>\r\n        <App />\r\n      </ThemeProvider>\r\n    </Provider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n)\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals()\r\n"],"sourceRoot":""}